"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var p=Math.max,d=Math.min;function ee(){}function te(s){var t=s.length-1;return function(){var e=c.call(arguments,0,t),n=c.call(arguments,t);return s.apply(this,e.concat([n]))}}function se(s){return te(function(r,a){"function"!=typeof r&&(r=m(r));var t=function(e){return r.apply(e,[e].concat(a))};return s.call(this,t)})}function ne(s){var t=c.call(arguments,1);return function(){return s.apply(this,t)}}function re(s,t){if(!t)throw new Error("prayer failed: "+s)}function ae(e){re("a direction was passed",e===le||e===oe)}function ie(s,t,e){re("a parent is always present",s),re("leftward is properly set up",function(){return t?t[oe]===e&&t.parent===s:s.ends[le]===e}()),re("rightward is properly set up",function(){return e?e[le]===t&&e.parent===s:s.ends[oe]===t}())}function s(){window.console&&console.warn("You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the \"`dev` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide\" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide")}function n(e){return s(),cs(e)}function e(l){function e(s){var t,r;return s&&s.nodeType?(t=pe(s).children(".mq-root-block").attr(Mt),r=t&&de.byId[t].controller,r?a[r.KIND_OF_MQ](r):null):null}function n(s,t){var e,l,o;t&&t.handlers&&(t.handlers={fns:t.handlers,APIClasses:a});for(e in t){t.hasOwnProperty(e)&&(l=t[e],o=be[e],s[e]=o?o(l):l)}}var a,t,i;if(!(Oe<=l&&l<=ve))throw"Only interface versions between "+Oe+" and "+ve+" supported. You specified: "+l;a={},e.L=le,e.R=oe,e.saneKeyboardEvents=je,e.config=function(e){return n(xe.p,e),this},e.registerEmbed=function(s,t){if(!/^[a-z][a-z0-9]*$/i.test(s))throw"Embed name must start with letter and be only letters and digits";ye[s]=t},t=a.AbstractMathQuill=h(qe,function(e){e.init=function(e){this.__controller=e,this.__options=e.options,this.id=e.id,this.data=e.data},e.__mathquillify=function(r){var t,a=this.__controller,n=a.root,i=a.container;a.createTextarea(),t=i.addClass(r).contents().detach(),n.jQ=pe("<span class=\"mq-root-block\"/>").attr(Mt,n.id).appendTo(i),this.latex(t.text()),this.revert=function(){return i.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(t)}},e.config=function(e){return n(this.__options,e),this},e.el=function(){return this.__controller.container[0]},e.text=function(){return this.__controller.exportText()},e.latex=function(e){return 0<arguments.length?(this.__controller.renderLatexMath(e),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},e.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},e.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),e.prototype=t.prototype,a.EditableField=h(t,function(t,e){t.__mathquillify=function(){return e.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},t.focus=function(){return this.__controller.textarea.focus(),this},t.blur=function(){return this.__controller.textarea.blur(),this},t.write=function(e){return this.__controller.writeLatex(e),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},t.empty=function(){var s=this.__controller.root,t=this.__controller.cursor;return s.eachChild("postOrder","dispose"),s.ends[le]=s.ends[oe]=0,s.jQ.empty(),delete t.selection,t.insAtRightEnd(s),this},t.cmd=function(s){var r,a=this.__controller.notify(),n=a.cursor;return /^\\[a-z]+$/i.test(s)?(s=s.slice(1),(r=me[s]||Ht[s])&&(s=r(s),n.selection&&s.replaces(n.replaceSelection()),s.createLeftOf(n.show()),this.__controller.scrollHoriz())):n.parent.write(n,s),a.blurred&&n.hide().parent.blur(),this},t.select=function(){var e=this.__controller;for(e.notify("move").cursor.insAtRightEnd(e.root);e.cursor[le];){e.selectLeft()}return this},t.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},t.moveToDirEnd=function(e){return this.__controller.notify("move").cursor.insAtDirEnd(e,this.__controller.root),this},t.moveToLeftEnd=function(){return this.moveToDirEnd(le)},t.moveToRightEnd=function(){return this.moveToDirEnd(oe)},t.keystroke=function(t){var s;for(t=t.replace(/^\s+|\s+$/g,"").split(/\s+/),s=0;s<t.length;s+=1){this.__controller.keystroke(t[s],{preventDefault:ee})}return this},t.typedText=function(s){for(var t=0;t<s.length;t+=1){this.__controller.typedText(s.charAt(t))}return this},t.dropEmbedded=function(a,t,e){var n,l=a-pe(window).scrollLeft(),s=t-pe(window).scrollTop(),r=document.elementFromPoint(l,s);this.__controller.seek(pe(r),a,t),n=Ut().setOptions(e),n.createLeftOf(this.__controller.cursor)},t.clickAt=function(r,t,e){e=e||document.elementFromPoint(r,t);var a=this.__controller,i=a.root;return us.contains(i.jQ[0],e)||(e=i.jQ[0]),a.seek(pe(e),r+pageXOffset,t+pageYOffset),a.blurred&&this.focus(),this},t.ignoreNextMousedown=function(e){return this.__controller.cursor.options.ignoreNextMousedown=e,this}}),e.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},e.EditableField.prototype=a.EditableField.prototype;for(i in we){!function(n,t){var p=a[n]=t(a);e[n]=function(t,r){var s,i=e(t);return i instanceof p||!t||!t.nodeType?i:(s=ge(p.RootBlock(),pe(t),xe()),s.KIND_OF_MQ=n,p(s).__mathquillify(r,l))},e[n].prototype=p.prototype}(i,we[i])}return e}function r(s){var t,r=["moveOutOf","deleteOutOf","selectOutOf","upOutOf","downOutOf"];for(t=0;t<r.length;t+=1){!function(n){s[n]=function(e){this.controller.handle(n,e)}}(r[t])}s.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function t(s,t,e){return h(Re,{ctrlSeq:s,htmlTemplate:"<"+t+" "+e+">&0</"+t+">"})}function l(s){var t=this.parent,e=s;do{if(e[oe])return s.insLeftOf(t);e=e.parent.parent}while(e!==t);s.insRightOf(t)}function i(s,t){s.jQadd=function(){t.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},s.reflow=function(){var e=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));Me(this.delimjQs,Ft(1+.2*(e-1),1.2),1.2*e)}}function o(r,t){var t=t||r,a=Nt[r],n=Nt[t];ue[r]=ne(Bt,le,r,a,t,n),ue[a]=ne(Bt,oe,r,a,t,n)}var u,c,m,h,le,oe,pe,f,de,ce,me,ue,he,fe,ge,we,xe,be,qe,ye,Oe,ve,ke,je,Qe,Te,Ce,Se,_e,De,Ee,Le,Ae,Re,Ie,Be,ze,Me,Fe,Pe,Ne,$e,We,Ue,He,Ve,Ke,Ge,Ye,Xe,Ze,Je,Bt,Nt,Wt,Ut,Ht,Vt,Kt,Gt,Yt,Xt,Zt,Jt,es,ts,ss,ns,rs,as,is,ls,os,ps,ds,cs,ms,us=window.jQuery,Mt="mathquill-block-id",Ft=d,$t=p;if(!us)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";c=[].slice,m=te(function(s,t){return te(function(n,e){if(s in n)return n[s].apply(n,t.concat(e))})}),h=function(n,t){function e(e){return"object"==("undefined"==typeof e?"undefined":_typeof(e))}function i(e){return"function"==typeof e}function s(){}return function r(p,d){function m(){var e=new a;return i(e.init)&&e.init.apply(e,arguments),e}function a(){}var l,f,g;return void 0===d&&(d=p,p=Object),m.Bare=a,l=s.prototype=p.prototype,f=a.prototype=m.prototype=m.p=new s,f.constructor=m,m.extend=function(t){return r(m,t)},(m.open=function(s){if(g={},i(s)?g=s.call(m,f,l,m,p):e(s)&&(g=s),e(g))for(var n in g){t.call(g,n)&&(f[n]=g[n])}return i(f.init)||(f.init=p),m})(d)}}(0,{}.hasOwnProperty),le=-1,oe=1,pe=h(us,function(e){e.insDirOf=function(s,t){return s===le?this.insertBefore(t.first()):this.insertAfter(t.last())},e.insAtDirEnd=function(s,t){return s===le?this.prependTo(t):this.appendTo(t)}}),f=h(function(e){e.parent=0,e[le]=0,e[oe]=0,e.init=function(s,t,e){this.parent=s,this[le]=t,this[oe]=e},this.copy=function(e){return f(e.parent,e[le],e[oe])}}),de=h(function(s){function t(){return e+=1}s[le]=0,s[oe]=0,s.parent=0;var e=0;this.byId={},s.init=function(){this.id=t(),de.byId[this.id]=this,this.ends={},this.ends[le]=0,this.ends[oe]=0},s.dispose=function(){delete de.byId[this.id]},s.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},s.jQ=pe(),s.jQadd=function(e){return this.jQ=this.jQ.add(e)},s.jQize=function(s){function r(e){var s,a;for(e.getAttribute&&(s=e.getAttribute("mathquill-command-id"),a=e.getAttribute("mathquill-block-id"),s&&de.byId[s].jQadd(e),a&&de.byId[a].jQadd(e)),e=e.firstChild;e;e=e.nextSibling){r(e)}}var e;for(s=pe(s||this.html()),e=0;e<s.length;e+=1){r(s[e])}return s},s.createDir=function(s,t){ae(s);var e=this;return e.jQize(),e.jQ.insDirOf(s,t.jQ),t[s]=e.adopt(t.parent,t[le],t[oe]),e},s.createLeftOf=function(e){return this.createDir(le,e)},s.selectChildren=function(s,t){return fe(s,t)},s.bubble=se(function(s){var t;for(t=this;t&&!1!==s(t);t=t.parent){}return this}),s.postOrder=se(function(s){return function t(e){e.eachChild(t),s(e)}(this),this}),s.isEmpty=function(){return 0===this.ends[le]&&0===this.ends[oe]},s.isStyleBlock=function(){return!1},s.children=function(){return ce(this.ends[le],this.ends[oe])},s.eachChild=function(){var e=this.children();return e.each.apply(e,arguments),this},s.foldChildren=function(s,t){return this.children().fold(s,t)},s.withDirAdopt=function(s,t,e,n){return ce(this,this).withDirAdopt(s,t,e,n),this},s.adopt=function(s,t,e){return ce(this,this).adopt(s,t,e),this},s.disown=function(){return ce(this,this).disown(),this},s.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),ce=h(function(e){e.init=function(s,t,e){if(e===u&&(e=le),ae(e),re("no half-empty fragments",!s==!t),this.ends={},s){re("withDir is passed to Fragment",s instanceof de),re("oppDir is passed to Fragment",t instanceof de),re("withDir and oppDir have the same parent",s.parent===t.parent),this.ends[e]=s,this.ends[-e]=t;var r=this.fold([],function(s,t){return s.push.apply(s,t.jQ.get()),s});this.jQ=this.jQ.add(r)}},e.jQ=pe(),e.withDirAdopt=function(s,t,e,n){return s===le?this.adopt(t,e,n):this.adopt(t,n,e)},e.adopt=function(a,t,l){var n,o,p;return ie(a,t,l),n=this,n.disowned=!1,(o=n.ends[le])?(p=n.ends[oe],t||(a.ends[le]=o),l?l[le]=p:a.ends[oe]=p,n.ends[oe][oe]=l,n.each(function(e){e[le]=t,e.parent=a,t&&(t[oe]=e),t=e}),n):this},e.disown=function(){var s,r,a=this,n=a.ends[le];return!n||a.disowned?a:(a.disowned=!0,s=a.ends[oe],r=n.parent,ie(r,n[le],n),ie(r,s,s[oe]),n[le]?n[le][oe]=s[oe]:r.ends[le]=s[oe],s[oe]?s[oe][le]=n[le]:r.ends[oe]=n[le],a)},e.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},e.each=se(function(s){var t=this,e=t.ends[le];if(!e)return t;for(;e!==t.ends[oe][oe]&&!1!==s(e);e=e[oe]){}return t}),e.fold=function(s,r){return this.each(function(e){s=r.call(this,s,e)}),s}}),me={},ue={},he=h(f,function(e){e.init=function(s,t){this.parent=s,this.options=t;var e=this.jQ=this._jQ=pe("<span class=\"mq-cursor\">&#8203;</span>");this.blink=function(){e.toggleClass("mq-blink")},this.upDownCache={}},e.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[oe]?this.selection&&this.selection.ends[le][le]===this[le]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[oe].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},e.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=pe(),this},e.withDirInsertAt=function(r,t,e,n){var a=this.parent;this.parent=t,this[r]=e,this[-r]=n,a!==t&&a.blur&&a.blur(this)},e.insDirOf=function(s,t){return ae(s),this.jQ.insDirOf(s,t.jQ),this.withDirInsertAt(s,t.parent,t[s],t),this.parent.jQ.addClass("mq-hasCursor"),this},e.insLeftOf=function(e){return this.insDirOf(le,e)},e.insRightOf=function(e){return this.insDirOf(oe,e)},e.insAtDirEnd=function(s,t){return ae(s),this.jQ.insAtDirEnd(s,t.jQ),this.withDirInsertAt(s,t,0,t.ends[s]),t.focus(),this},e.insAtLeftEnd=function(e){return this.insAtDirEnd(le,e)},e.insAtRightEnd=function(e){return this.insAtDirEnd(oe,e)},e.jumpUpDown=function(r,t){var e,a,l=this;l.upDownCache[r.id]=f.copy(l),e=l.upDownCache[t.id],e?e[oe]?l.insLeftOf(e[oe]):l.insAtRightEnd(e.parent):(a=l.offset().left,t.seek(a,l))},e.offset=function(){var s=this,t=s.jQ.removeClass("mq-cursor").offset();return s.jQ.addClass("mq-cursor"),t},e.unwrapGramp=function(){var r=this.parent.parent,t=r.parent,e=r[oe],n=this,a=r[le];if(r.disown().eachChild(function(s){s.isEmpty()||(s.children().adopt(t,a,e).each(function(t){t.jQ.insertBefore(r.jQ.first())}),a=s.ends[oe])}),!this[oe])if(this[le])this[oe]=this[le][oe];else for(;!this[oe];){if(this.parent=this.parent[oe],!this.parent){this[oe]=r[oe],this.parent=t;break}this[oe]=this.parent.ends[le]}this[oe]?this.insLeftOf(this[oe]):this.insAtRightEnd(t),r.jQ.remove(),r[le].siblingDeleted&&r[le].siblingDeleted(n.options,oe),r[oe].siblingDeleted&&r[oe].siblingDeleted(n.options,le)},e.startSelection=function(){var s,r=this.anticursor=f.copy(this),e=r.ancestors={};for(s=r;s.parent;s=s.parent){e[s.parent.id]=s}},e.endSelection=function(){delete this.anticursor},e.select=function(){var s,p,d,c,m,u,h,g=this.anticursor;if(this[le]===g[le]&&this.parent===g.parent)return!1;for(s=this;s.parent;s=s.parent){if(s.parent.id in g.ancestors){p=s.parent;break}}if(re("cursor and anticursor in the same tree",p),d=g.ancestors[p.id],u=oe,s[le]!==d)for(h=s;h;h=h[oe]){if(h[oe]===d[oe]){u=le,c=s,m=d;break}}return u===oe&&(c=d,m=s),c instanceof f&&(c=c[oe]),m instanceof f&&(m=m[le]),this.hide().selection=p.selectChildren(c,m),this.insDirOf(u,this.selection.ends[u]),this.selectionChanged(),!0},e.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},e.deleteSelection=function(){this.selection&&(this[le]=this.selection.ends[le][le],this[oe]=this.selection.ends[oe][oe],this.selection.remove(),this.selectionChanged(),delete this.selection)},e.replaceSelection=function(){var e=this.selection;return e&&(this[le]=e.ends[le][le],this[oe]=e.ends[oe][oe],delete this.selection),e}}),fe=h(ce,function(s,t){s.init=function(){t.init.apply(this,arguments),this.jQ=this.jQ.wrapAll("<span class=\"mq-selection\"></span>").parent()},s.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),t.adopt.apply(this,arguments)},s.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},s.join=function(s){return this.fold("",function(t,e){return t+e[s]()})}}),ge=h(function(s){s.init=function(s,t,e){this.id=s.id,this.data={},this.root=s,this.container=t,this.options=e,s.controller=this,this.cursor=s.cursor=he(s,e)},s.handle=function(s,t){var e,r=this.options.handlers;r&&r.fns[s]&&(e=r.APIClasses[this.KIND_OF_MQ](this),t===le||t===oe?r.fns[s](t,e):r.fns[s](e))};var n=[];this.onNotify=function(e){n.push(e)},s.notify=function(){for(var e=0;e<n.length;e+=1){n[e].apply(this.cursor,arguments)}return this}}),we={},xe=h(),be={},qe=h(),ye={},n.prototype=qe.p,n.VERSION="v0.10.1",n.interfaceVersion=function(e){if(1!==e)throw"Only interface version 1 supported. You specified: "+e;return s=function(){window.console&&console.warn("You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the \"`dev` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide\" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide")},s(),n},n.getInterface=e,Oe=e.MIN=1,ve=e.MAX=2,n.noConflict=function(){return window.MathQuill=ke,n},ke=window.MathQuill,window.MathQuill=n,je=function(){function t(n){var t,l=n.which||n.keyCode,i=a[l],s=[];return n.ctrlKey&&s.push("Ctrl"),n.originalEvent&&n.originalEvent.metaKey&&s.push("Meta"),n.altKey&&s.push("Alt"),n.shiftKey&&s.push("Shift"),t=i||String.fromCharCode(l),s.length||i?(s.push(t),s.join("-")):t}var a={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(e,n){function i(e){q=e,clearTimeout(m),m=setTimeout(e)}function s(t){i(function(e){q=ee,clearTimeout(m),t(e)})}function r(t){q(),q=ee,clearTimeout(m),k.val(t),t&&k[0].select&&k[0].select(),h=!!t}function o(){var e=k[0];return"selectionStart"in e&&e.selectionStart!==e.selectionEnd}function a(){n.keystroke(t(f),f)}function l(e){f=e,O=null,h&&s(function(e){e&&"focusout"===e.type||!k[0].select||k[0].select()}),a()}function p(e){f&&O&&a(),O=e,i(c)}function d(){f&&!O&&i(c)}function c(){if(!o()){var e=k.val();1===e.length?(k.val(""),n.typedText(e)):e&&k[0].select&&k[0].select()}}function u(){var e=k.val();k.val(""),e&&n.paste(e)}var m,h,f=null,O=null,k=us(e),x=us(n.container||k),q=ee;return x.bind("keydown keypress input keyup focusout paste",function(e){q(e)}),h=!1,x.bind({keydown:l,keypress:p,keyup:d,focusout:function(){f=O=null},cut:function e(){s(function(){n.cut()})},copy:function e(){s(function(){n.copy()})},paste:function(){k.focus(),i(u)}}),{select:r}}}(),Qe=h(function(s,t,l){function n(s,n){throw s=s?"'"+s+"'":"EOF","Parse Error: "+n+" at "+s}var e,i,p;s.init=function(e){this._=e},s.parse=function(s){function t(s,t){return t}return this.skip(p)._(""+s,t,n)},s.or=function(r){re("or is passed a parser",r instanceof l);var t=this;return l(function(e,n,a){return t._(e,n,function(){return r._(e,n,a)})})},s.then=function(s){var t=this;return l(function(e,n,r){function i(t,e){var i=s instanceof l?s:s(e);return re("a parser is returned",i instanceof l),i._(t,n,r)}return t._(e,i,r)})},s.many=function(){var n=this;return l(function(a,t){function i(e,t){return a=e,r.push(t),!0}function s(){return!1}for(var r=[];n._(a,i,s);){}return t(a,r)})},s.times=function(s,t){2>arguments.length&&(t=s);var p=this;return l(function(i,e,d){function r(s,t){return g.push(t),i=s,!0}function o(s,t){return l=t,i=s,!1}function a(){return!1}var l,m,g=[],u=!0;for(m=0;m<s;m+=1){if(!(u=p._(i,r,o)))return d(i,l)}for(;m<t&&u;m+=1){u=p._(i,r,a)}return e(i,g)})},s.result=function(e){return this.then(i(e))},s.atMost=function(e){return this.times(0,e)},s.atLeast=function(s){var n=this;return n.times(s).then(function(s){return n.many().map(function(t){return s.concat(t)})})},s.map=function(s){return this.then(function(t){return i(s(t))})},s.skip=function(s){return this.then(function(t){return s.result(t)})},this.string=function(a){var t=a.length;return l(function(e,n,s){var r=e.slice(0,t);return r===a?n(e.slice(t),r):s(e,"expected '"+a+"'")})},e=this.regex=function(e){re("regexp parser is anchored","^"===e.toString().charAt(1));return l(function(t,n,a){var s,i=e.exec(t);return i?(s=i[0],n(t.slice(s.length),s)):a(t,"expected "+e)})},i=l.succeed=function(s){return l(function(t,e){return e(t,s)})},l.fail=function(s){return l(function(t,e,n){return n(t,s)})},l.letter=e(/^[a-z]/i),l.letters=e(/^[a-z]*/i),l.digit=e(/^[0-9]/),l.digits=e(/^[0-9]*/),l.whitespace=e(/^\s+/),l.optWhitespace=e(/^\s*/),l.any=l(function(s,t,e){return s?t(s.slice(1),s.charAt(0)):e(s,"expected any character")}),l.all=l(function(s,t){return t("",s)}),p=l.eof=l(function(s,t,e){return s?e(s,"expected EOF"):t(s,s)})}),ge.open(function(e){e.focusBlurEvents=function(){function a(){clearTimeout(e),s.selection&&s.selection.jQ.addClass("mq-blur"),t()}function t(){s.hide().parent.blur(),l.container.removeClass("mq-focused"),pe(window).unbind("blur",a)}var e,l=this,i=l.root,s=l.cursor;l.textarea.focus(function(){l.blurred=!1,clearTimeout(e),l.container.addClass("mq-focused"),s.parent||s.insAtRightEnd(i),s.selection?(s.selection.jQ.removeClass("mq-blur"),l.selectionChanged()):s.show()}).blur(function(){l.blurred=!0,e=setTimeout(function(){i.postOrder("intentionalBlur"),s.clearSelection().endSelection(),t()}),pe(window).bind("blur",a)}),l.blurred=!0,s.hide().parent.blur()}}),ge.open(function(e){e.exportText=function(){return this.root.foldChildren("",function(s,t){return s+t.text()})}}),ge.open(function(t){xe.p.ignoreNextMousedown=ee,t.delegateMouseEvents=function(){var t=this.root.jQ;this.container.bind("mousedown.mathquill",function(e){function n(e){r=pe(e.target)}function i(e){c.anticursor||c.startSelection(),l.seek(r,e.pageX,e.pageY).cursor.select(),r=u}function s(e){c.blink=m,c.selection||(l.editable?c.show():h.detach()),d.unbind("mousemove",n),pe(e.target.ownerDocument).unbind("mousemove",i).unbind("mouseup",s)}var r,d=pe(e.target).closest(".mq-root-block"),a=de.byId[d.attr("mathquill-block-id")||t.attr("mathquill-block-id")],l=a.controller,c=l.cursor,m=c.blink,h=l.textareaSpan,f=l.textarea;e.preventDefault(),e.target.unselectable=!0,c.options.ignoreNextMousedown(e)||(c.options.ignoreNextMousedown=ee,l.blurred&&(l.editable||d.prepend(h),f.focus()),c.blink=ee,l.seek(pe(e.target),e.pageX,e.pageY).cursor.startSelection(),d.mousemove(n),pe(e.target.ownerDocument).mousemove(i).mouseup(s))})}}),ge.open(function(e){e.seek=function(s,t){var e,n,l,p=this.notify("select").cursor;return s&&((e=s.attr("mathquill-block-id")||s.attr("mathquill-command-id"))||(n=s.parent(),e=n.attr("mathquill-block-id")||n.attr("mathquill-command-id"))),l=e?de.byId[e]:this.root,re("nodeId is the id of some Node that exists",l),p.clearSelection().show(),l.seek(t,p),this.scrollHoriz(),this}}),ge.open(function(e){e.keystroke=function(s,t){this.cursor.parent.keystroke(s,t,this)}}),de.open(function(e){e.keystroke=function(s,t,e){var n=e.cursor;switch(s){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":e.ctrlDeleteDir(le);break;case"Shift-Backspace":case"Backspace":e.backspace();break;case"Esc":case"Tab":return void e.escapeDir(oe,s,t);case"Shift-Tab":case"Shift-Esc":return void e.escapeDir(le,s,t);case"End":e.notify("move").cursor.insAtRightEnd(n.parent);break;case"Ctrl-End":e.notify("move").cursor.insAtRightEnd(e.root);break;case"Shift-End":for(;n[oe];){e.selectRight()}break;case"Ctrl-Shift-End":for(;n[oe]||n.parent!==e.root;){e.selectRight()}break;case"Home":e.notify("move").cursor.insAtLeftEnd(n.parent);break;case"Ctrl-Home":e.notify("move").cursor.insAtLeftEnd(e.root);break;case"Shift-Home":for(;n[le];){e.selectLeft()}break;case"Ctrl-Shift-Home":for(;n[le]||n.parent!==e.root;){e.selectLeft()}break;case"Left":e.moveLeft();break;case"Shift-Left":e.selectLeft();break;case"Ctrl-Left":break;case"Right":e.moveRight();break;case"Shift-Right":e.selectRight();break;case"Ctrl-Right":break;case"Up":e.moveUp();break;case"Down":e.moveDown();break;case"Shift-Up":if(n[le])for(;n[le];){e.selectLeft()}else e.selectLeft();case"Shift-Down":if(n[oe])for(;n[oe];){e.selectRight()}else e.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":e.ctrlDeleteDir(oe);break;case"Shift-Del":case"Del":e.deleteForward();break;case"Meta-A":case"Ctrl-A":for(e.notify("move").cursor.insAtRightEnd(e.root);n[le];){e.selectLeft()}break;default:return;}t.preventDefault(),e.scrollHoriz()},e.moveOutOf=e.moveTowards=e.deleteOutOf=e.deleteTowards=e.unselectInto=e.selectOutOf=e.selectTowards=function(){re("overridden or never called on this node")}}),ge.open(function(s){function t(r,t){var a=r.notify("upDown").cursor,e=t+"Into",n=t+"OutOf";return a[oe][e]?a.insAtLeftEnd(a[oe][e]):a[le][e]?a.insAtRightEnd(a[le][e]):a.parent.bubble(function(s){var t=s[n];if(t&&("function"==typeof t&&(t=s[n](a)),t instanceof de&&a.jumpUpDown(s,t),!0!==t))return!1}),r}this.onNotify(function(e){"move"!==e&&"upDown"!==e||this.show().clearSelection()}),s.escapeDir=function(s,t,e){ae(s);var n=this.cursor;if(n.parent!==this.root&&e.preventDefault(),n.parent!==this.root)return n.parent.moveOutOf(s,n),this.notify("move")},be.leftRightIntoCmdGoes=function(e){if(e&&"up"!==e&&"down"!==e)throw"\"up\" or \"down\" required for leftRightIntoCmdGoes option, got \""+e+"\"";return e},s.moveDir=function(s){ae(s);var t=this.cursor,e=t.options.leftRightIntoCmdGoes;return t.selection?t.insDirOf(s,t.selection.ends[s]):t[s]?t[s].moveTowards(s,t,e):t.parent.moveOutOf(s,t,e),this.notify("move")},s.moveLeft=function(){return this.moveDir(le)},s.moveRight=function(){return this.moveDir(oe)},s.moveUp=function(){return t(this,"up")},s.moveDown=function(){return t(this,"down")},this.onNotify(function(e){"upDown"!==e&&(this.upDownCache={})}),this.onNotify(function(e){"edit"===e&&this.show().deleteSelection()}),s.deleteDir=function(s){var t,r;return ae(s),t=this.cursor,r=t.selection,this.notify("edit"),r||(t[s]?t[s].deleteTowards(s,t):t.parent.deleteOutOf(s,t)),t[le].siblingDeleted&&t[le].siblingDeleted(t.options,oe),t[oe].siblingDeleted&&t[oe].siblingDeleted(t.options,le),t.parent.bubble("reflow"),this},s.ctrlDeleteDir=function(s){ae(s);var t=this.cursor;return!t[s]||t.selection?this.deleteDir(s):(this.notify("edit"),s===le?ce(t.parent.ends[le],t[le]).remove():ce(t[oe],t.parent.ends[oe]).remove(),t.insAtDirEnd(s,t.parent),t[le].siblingDeleted&&t[le].siblingDeleted(t.options,oe),t[oe].siblingDeleted&&t[oe].siblingDeleted(t.options,le),t.parent.bubble("reflow"),this)},s.backspace=function(){return this.deleteDir(le)},s.deleteForward=function(){return this.deleteDir(oe)},this.onNotify(function(e){"select"!==e&&this.endSelection()}),s.selectDir=function(s){var t,r=this.notify("select").cursor,n=r.selection;ae(s),r.anticursor||r.startSelection(),t=r[s],t?n&&n.ends[s]===t&&r.anticursor[-s]!==t?t.unselectInto(s,r):t.selectTowards(s,r):r.parent.selectOutOf(s,r),r.clearSelection(),r.select()||r.show()},s.selectLeft=function(){return this.selectDir(le)},s.selectRight=function(){return this.selectDir(oe)}}),ge.open(function(e){xe.p.substituteTextarea=function(){return pe("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},e.createTextarea=function(){var s,r=this.textareaSpan=pe("<span class=\"mq-textarea\"></span>"),e=this.options.substituteTextarea();if(!e.nodeType)throw"substituteTextarea() must return a DOM element, got "+e;e=this.textarea=pe(e).appendTo(r),s=this,s.cursor.selectionChanged=function(){s.selectionChanged()}},e.selectionChanged=function(){var e=this;Fe(e.container[0]),e.textareaSelectionTimeout===u&&(e.textareaSelectionTimeout=setTimeout(function(){e.setTextareaSelection()}))},e.setTextareaSelection=function(){this.textareaSelectionTimeout=u;var e="";this.cursor.selection&&(e=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(e="$"+e+"$")),this.selectFn(e)},e.staticMathTextareaEvents=function(){function r(){a.detach(),t.blurred=!0}var t=this,e=(t.root,t.cursor),n=t.textarea,a=t.textareaSpan;this.container.prepend(us("<span class=\"mq-selectable\">").text("$"+t.exportLatex()+"$")),t.blurred=!0,n.bind("cut paste",!1).bind("copy",function(){t.setTextareaSelection()}).focus(function(){t.blurred=!1}).blur(function(){e.selection&&e.selection.clear(),setTimeout(r)}),t.selectFn=function(e){n.val(e),e&&n.select()}},xe.p.substituteKeyboardEvents=je,e.editablesTextareaEvents=function(){var s=this,t=s.textarea,e=s.textareaSpan,n=this.options.substituteKeyboardEvents(t,this);this.selectFn=function(e){n.select(e)},this.container.prepend(e),this.focusBlurEvents()},e.typedText=function(s){if("\n"===s)return this.handle("enter");var t=this.notify().cursor;t.parent.write(t,s),this.scrollHoriz()},e.cut=function(){var s=this,t=s.cursor;t.selection&&setTimeout(function(){s.notify("edit"),t.parent.bubble("reflow")})},e.copy=function(){this.setTextareaSelection()},e.paste=function(e){this.options.statelessClipboard&&(e="$"===e.slice(0,1)&&"$"===e.slice(-1)?e.slice(1,-1):"\\text{"+e+"}"),this.writeLatex(e).cursor.show()}}),Te=function(){function w(s){var t=Le();return s.adopt(t,0,0),t}function t(s){var t,r=s[0]||Le();for(t=1;t<s.length;t+=1){s[t].children().adopt(r,r.ends[oe],0)}return r}var e=Qe.string,n=Qe.regex,i=Qe.letter,s=Qe.any,r=Qe.optWhitespace,o=Qe.succeed,a=Qe.fail,l=i.map(function(e){return Zt(e)}),c=n(/^[^${}\\_^]/).map(function(e){return De(e)}),h=n(/^[^\\a-eg-zA-Z]/).or(e("\\").then(n(/^[a-z]+/i).or(n(/^\s+/).result(" ")).or(s))).then(function(s){var t=me[s];return t?t(s).parser():a("unknown command: \\"+s)}),u=h.or(l).or(c),f=e("{").then(function(){return d}).skip(e("}")),p=r.then(f.or(u.map(w))),d=p.many().map(t).skip(r),m=e("[").then(p.then(function(e){return"]"!==e.join("latex")?o(e):a()}).many().map(t).skip(r)).skip(e("]")),g=d;return g.block=p,g.optBlock=m,g}(),ge.open(function(e){e.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},e.writeLatex=function(a){var t,l=this.notify("edit").cursor,n=Qe.all,i=Qe.eof,s=Te.skip(i).or(n.result(!1)).parse(a);return s&&!s.isEmpty()&&(s.children().adopt(l.parent,l[le],l[oe]),t=s.jQize(),t.insertBefore(l.jQ),l[le]=s.ends[oe],s.finalizeInsert(l.options,l),s.ends[oe][oe].siblingCreated&&s.ends[oe][oe].siblingCreated(l.options,le),s.ends[le][le].siblingCreated&&s.ends[le][le].siblingCreated(l.options,oe),l.parent.bubble("reflow")),this},e.renderLatexMath=function(l){var t,p,d=this.root,i=this.cursor,s=Qe.all,r=Qe.eof,o=Te.skip(r).or(s.result(!1)).parse(l);d.eachChild("postOrder","dispose"),d.ends[le]=d.ends[oe]=0,o&&o.children().adopt(d,0,0),t=d.jQ,o?(p=o.join("html"),t.html(p),d.jQize(t.children()),d.finalizeInsert(i.options)):t.empty(),delete i.selection,i.insAtRightEnd(d)},e.renderLatexText=function(p){var t,d,m,g,w,x,b,q,y,O,v=this.root,u=this.cursor;if(v.jQ.children().slice(1).remove(),v.eachChild("postOrder","dispose"),v.ends[le]=v.ends[oe]=0,delete u.selection,u.show().insAtRightEnd(v),t=Qe.regex,d=Qe.string,m=Qe.eof,g=Qe.all,w=d("$").then(Te).skip(d("$").or(m)).map(function(s){var t,r=Be(u);return r.createBlocks(),t=r.ends[le],s.children().adopt(t,0,0),r}),x=d("\\$").result("$"),b=x.or(t(/^[^$]/)).map(De),q=w.or(b).many(),y=q.skip(m).or(g.result(!1)).parse(p)){for(O=0;O<y.length;O+=1){y[O].adopt(v,v.ends[oe],0)}v.jQize().appendTo(v.jQ),v.finalizeInsert(u.options)}}}),ge.open(function(e){e.scrollHoriz=function(){var l,p,d,c,m,u=this.cursor,r=u.selection,o=this.root.jQ[0].getBoundingClientRect();if(r){if(d=r.jQ[0].getBoundingClientRect(),c=d.left-(o.left+20),m=d.right-(o.right-20),r.ends[le]===u[oe]){if(0>c)p=c;else{if(!(0<m))return;p=d.left-m<o.left+20?c:m}}else if(0<m)p=m;else{if(!(0>c))return;p=d.right-c>o.right-20?m:c}}else if((l=u.jQ[0].getBoundingClientRect().left)>o.right-20)p=l-(o.right-20);else{if(!(l<o.left+20))return;p=l-(o.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+p},100)}}),Ce=h(de,function(e){e.finalizeInsert=function(s,t){var e=this;e.postOrder("finalizeTree",s),e.postOrder("contactWeld",t),e.postOrder("blur"),e.postOrder("reflow"),e[oe].siblingCreated&&e[oe].siblingCreated(s,le),e[le].siblingCreated&&e[le].siblingCreated(s,oe),e.bubble("reflow")}}),Se=h(Ce,function(s,r){s.init=function(e,t,n){var a=this;r.init.call(a),a.ctrlSeq||(a.ctrlSeq=e),t&&(a.htmlTemplate=t),n&&(a.textTemplate=n)},s.replaces=function(e){e.disown(),this.replacedFragment=e},s.isEmpty=function(){return this.foldChildren(!0,function(s,t){return s&&t.isEmpty()})},s.parser=function(){var s=Te.block,r=this;return s.times(r.numBlocks()).map(function(e){r.blocks=e;for(var t=0;t<e.length;t+=1){e[t].adopt(r,r.ends[oe],0)}return r})},s.createLeftOf=function(e){var t=this,s=t.replacedFragment;t.createBlocks(),r.createLeftOf.call(t,e),s&&(s.adopt(t.ends[le],0,0),s.jQ.appendTo(t.ends[le].jQ)),t.finalizeInsert(e.options),t.placeCursor(e)},s.createBlocks=function(){var r,a,l=this,n=l.numBlocks(),i=l.blocks=Array(n);for(r=0;r<n;r+=1){a=i[r]=Le(),a.adopt(l,l.ends[oe],0)}},s.placeCursor=function(e){e.insAtRightEnd(this.foldChildren(this.ends[le],function(s,t){return s.isEmpty()?s:t}))},s.moveTowards=function(s,t,e){var n=e&&this[e+"Into"];t.insAtDirEnd(-s,n||this.ends[-s])},s.deleteTowards=function(s,t){this.isEmpty()?t[s]=this.remove()[s]:this.moveTowards(s,t,null)},s.selectTowards=function(s,t){t[-s]=this,t[s]=this[s]},s.selectChildren=function(){return fe(this,this)},s.unselectInto=function(s,t){t.insAtDirEnd(-s,t.anticursor.ancestors[this.id])},s.seek=function(l,t){function e(s){var t={};return t[le]=s.jQ.offset().left,t[oe]=t[le]+s.jQ.outerWidth(),t}var n,p=this,s=e(p);return l<s[le]?t.insLeftOf(p):l>s[oe]?t.insRightOf(p):(n=s[le],void p.eachChild(function(r){var i=e(r);return l<i[le]?(l-n<i[le]-l?r[le]?t.insAtRightEnd(r[le]):t.insLeftOf(p):t.insAtLeftEnd(r),!1):l>i[oe]?void(r[oe]?n=i[oe]:s[oe]-l<l-i[oe]?t.insRightOf(p):t.insAtRightEnd(r)):(r.seek(l,t),!1)}))},s.numBlocks=function(){var e=this.htmlTemplate.match(/&\d+/g);return e?e.length:0},s.html=function(){var s,l,p,d=this,i=d.blocks,r=" mathquill-command-id="+d.id,o=d.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(re("no unmatched angle brackets",o.join("")===this.htmlTemplate),s=0,l=o[0];l;s+=1,l=o[s]){if("/>"===l.slice(-2))o[s]=l.slice(0,-2)+r+"/>";else if("<"===l.charAt(0)){re("not an unmatched top-level close tag","/"!==l.charAt(1)),o[s]=l.slice(0,-1)+r+">",p=1;do{s+=1,l=o[s],re("no missing close tags",l),"</"===l.slice(0,2)?p-=1:"<"===l.charAt(0)&&"/>"!==l.slice(-2)&&(p+=1)}while(0<p)}}return o.join("").replace(/>&(\d+)/g,function(s,t){return" mathquill-block-id="+i[t].id+">"+i[t].join("html")})},s.latex=function(){return this.foldChildren(this.ctrlSeq,function(s,t){return s+"{"+(t.latex()||" ")+"}"})},s.textTemplate=[""],s.text=function(){var r=this,t=0;return r.foldChildren(r.textTemplate[t],function(e,n){t+=1;var a=n.text();return e&&"("===r.textTemplate[t]&&"("===a[0]&&")"===a.slice(-1)?e+a.slice(1,-1)+r.textTemplate[t]:e+n.text()+(r.textTemplate[t]||"")})}}),_e=h(Se,function(t,s){t.init=function(n,t,e){e||(e=n&&1<n.length?n.slice(1):n),s.init.call(this,n,t,[e])},t.parser=function(){return Qe.succeed(this)},t.numBlocks=function(){return 0},t.replaces=function(e){e.remove()},t.createBlocks=ee,t.moveTowards=function(s,t){t.jQ.insDirOf(s,this.jQ),t[-s]=this,t[s]=this[s]},t.deleteTowards=function(s,t){t[s]=this.remove()[s]},t.seek=function(s,t){s-this.jQ.offset().left<this.jQ.outerWidth()/2?t.insLeftOf(this):t.insRightOf(this)},t.latex=function(){return this.ctrlSeq},t.text=function(){return this.textTemplate},t.placeCursor=ee,t.isEmpty=function(){return!0}}),De=h(_e,function(s,r){s.init=function(e,t){r.init.call(this,e,"<span>"+(t||e)+"</span>")}}),Ee=h(_e,function(s,r){s.init=function(e,t,s){r.init.call(this,e,"<span class=\"mq-binary-operator\">"+t+"</span>",s)}}),Le=h(Ce,function(s,r){s.join=function(s){return this.foldChildren("",function(t,e){return t+e[s]()})},s.html=function(){return this.join("html")},s.latex=function(){return this.join("latex")},s.text=function(){return this.ends[le]===this.ends[oe]&&0!==this.ends[le]?this.ends[le].text():this.join("text")},s.keystroke=function(e,t,s){return!s.options.spaceBehavesLikeTab||"Spacebar"!==e&&"Shift-Spacebar"!==e?r.keystroke.apply(this,arguments):(t.preventDefault(),void s.escapeDir("Shift-Spacebar"===e?le:oe,e,t))},s.moveOutOf=function(s,t,e){e&&this.parent[e+"Into"]||!this[s]?t.insDirOf(s,this.parent):t.insAtDirEnd(-s,this[s])},s.selectOutOf=function(s,t){t.insDirOf(s,this.parent)},s.deleteOutOf=function(s,t){t.unwrapGramp()},s.seek=function(s,t){var e=this.ends[oe];if(!e||e.jQ.offset().left+e.jQ.outerWidth()<s)return t.insAtRightEnd(this);if(s<this.ends[le].jQ.offset().left)return t.insAtLeftEnd(this);for(;s<e.jQ.offset().left;){e=e[le]}return e.seek(s,t)},s.chToCmd=function(s,t){var e;return s.match(/^[a-eg-zA-Z]$/)?Zt(s):/^\d$/.test(s)?Yt(s):t&&t.typingSlashWritesDivisionSymbol&&"/"===s?me["\xF7"](s):t&&t.typingAsteriskWritesTimesSymbol&&"*"===s?me["\xD7"](s):(e=ue[s]||me[s])?e(s):De(s)},s.write=function(s,t){var e=this.chToCmd(t,s.options);s.selection&&e.replaces(s.replaceSelection()),e.createLeftOf(s.show())},s.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},s.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),we.StaticMath=function(s){return h(s.AbstractMathQuill,function(t,r){this.RootBlock=Le,t.__mathquillify=function(e){return this.config(e),r.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},t.init=function(){r.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],s.MathField)},t.latex=function(){var t=r.latex.apply(this,arguments);return 0<arguments.length&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],s.MathField),t}})},Ae=h(Le,r),we.MathField=function(t){return h(t.EditableField,function(t,s){this.RootBlock=Ae,t.__mathquillify=function(t,e){return this.config(t),1<e&&(this.__controller.root.reflow=ee),s.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},Re=h(de,function(s,r){function p(s){var t,r;if(s.jQ[0].normalize(),t=s.jQ[0].firstChild)return re("only node in TextBlock span is Text node",3===t.nodeType),r=Ie(t.data),r.jQadd(t),s.children().disown(),r.adopt(s,0,0)}s.ctrlSeq="\\text",s.replaces=function(e){e instanceof ce?this.replacedText=e.remove().jQ.text():"string"==typeof e&&(this.replacedText=e)},s.jQadd=function(e){r.jQadd.call(this,e),this.ends[le]&&this.ends[le].jQadd(this.jQ[0].firstChild)},s.createLeftOf=function(e){var t,s=this;if(r.createLeftOf.call(this,e),s[oe].siblingCreated&&s[oe].siblingCreated(e.options,le),s[le].siblingCreated&&s[le].siblingCreated(e.options,oe),s.bubble("reflow"),e.insAtRightEnd(s),s.replacedText)for(t=0;t<s.replacedText.length;t+=1){s.write(e,s.replacedText.charAt(t))}},s.parser=function(){var s=this,t=Qe.string,e=Qe.regex;return Qe.optWhitespace.then(t("{")).then(e(/^[^}]*/)).skip(t("}")).map(function(t){return 0===t.length?ce():(Ie(t).adopt(s,0,0),s)})},s.textContents=function(){return this.foldChildren("",function(s,t){return s+t.text})},s.text=function(){return"\""+this.textContents()+"\""},s.latex=function(){var e=this.textContents();return 0===e.length?"":"\\text{"+e.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&")+"}"},s.html=function(){return"<span class=\"mq-text-mode\" mathquill-command-id="+this.id+">"+this.textContents()+"</span>"},s.moveTowards=function(s,t){t.insAtDirEnd(-s,this)},s.moveOutOf=function(s,t){t.insDirOf(s,this)},s.unselectInto=s.moveTowards,s.selectTowards=Se.prototype.selectTowards,s.deleteTowards=Se.prototype.deleteTowards,s.selectOutOf=function(s,t){t.insDirOf(s,this)},s.deleteOutOf=function(s,t){this.isEmpty()&&t.insRightOf(this)},s.write=function(e,t){var n,a;e.show().deleteSelection(),"$"!==t?e[le]?e[le].appendText(t):Ie(t).createLeftOf(e):this.isEmpty()?(e.insRightOf(this),De("\\$","$").createLeftOf(e)):e[oe]?e[le]?(n=Re(),a=this.ends[le],a.disown().jQ.detach(),a.adopt(n,0,0),e.insLeftOf(this),r.createLeftOf.call(n,e)):e.insLeftOf(this):e.insRightOf(this)},s.seek=function(n,t){var e,d,m,u,g,w,x,b;for(t.hide(),e=p(this),d=this.jQ.width()/this.text.length,m=Math.round((n-this.jQ.offset().left)/d),0>=m?t.insAtLeftEnd(this):m>=e.text.length?t.insAtRightEnd(this):t.insLeftOf(e.splitRight(m)),u=n-t.show().offset().left,g=u&&0>u?le:oe,w=g;t[g]&&0<u*w;){t[g].moveTowards(g,t),w=u,u=n-t.offset().left}g*u<-g*w&&t[-g].moveTowards(-g,t),t.anticursor?t.anticursor.parent===this&&(x=t[le]&&t[le].text.length,this.anticursorPosition===x?t.anticursor=f.copy(t):(this.anticursorPosition<x?(b=t[le].splitRight(this.anticursorPosition),t[le]=b):b=t[oe].splitRight(this.anticursorPosition-x),t.anticursor=f(this,b[le],b))):this.anticursorPosition=t[le]&&t[le].text.length},s.blur=function(e){Le.prototype.blur.call(this),e&&(""===this.textContents()?(this.remove(),e[le]===this?e[le]=this[le]:e[oe]===this&&(e[oe]=this[oe])):p(this))},s.focus=Le.prototype.focus}),Ie=h(de,function(s,r){function l(s,t){return t.charAt(s===le?0:-1+t.length)}s.init=function(e){r.init.call(this),this.text=e},s.jQadd=function(e){this.dom=e,this.jQ=pe(e)},s.jQize=function(){return this.jQadd(document.createTextNode(this.text))},s.appendText=function(e){this.text+=e,this.dom.appendData(e)},s.prependText=function(e){this.text=e+this.text,this.dom.insertData(0,e)},s.insTextAtDirEnd=function(s,t){ae(t),t===oe?this.appendText(s):this.prependText(s)},s.splitRight=function(s){var t=Ie(this.text.slice(s)).adopt(this.parent,this,this[oe]);return t.jQadd(this.dom.splitText(s)),this.text=this.text.slice(0,s),t},s.moveTowards=function(n,t){var e,r;return ae(n),e=l(-n,this.text),r=this[-n],r?r.insTextAtDirEnd(e,n):Ie(e).createDir(-n,t),this.deleteTowards(n,t)},s.latex=function(){return this.text},s.deleteTowards=function(s,t){1<this.text.length?s===oe?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),t[s]=this[s])},s.selectTowards=function(n,t){var e,r,p,d;return ae(n),e=t.anticursor,r=l(-n,this.text),e[n]===this?(p=Ie(r).createDir(n,t),e[n]=p,t.insDirOf(n,p)):(d=this[-n],d?d.insTextAtDirEnd(r,n):(p=Ie(r).createDir(-n,t),p.jQ.insDirOf(-n,t.selection.jQ)),1===this.text.length&&e[-n]===this&&(e[-n]=this[-n])),this.deleteTowards(n,t)}}),me.text=me.textnormal=me.textrm=me.textup=me.textmd=Re,me.em=me.italic=me.italics=me.emph=me.textit=me.textsl=t("\\textit","i","class=\"mq-text-mode\""),me.strong=me.bold=me.textbf=t("\\textbf","b","class=\"mq-text-mode\""),me.sf=me.textsf=t("\\textsf","span","class=\"mq-sans-serif mq-text-mode\""),me.tt=me.texttt=t("\\texttt","span","class=\"mq-monospace mq-text-mode\""),me.textsc=t("\\textsc","span","style=\"font-variant:small-caps\" class=\"mq-text-mode\""),me.uppercase=t("\\uppercase","span","style=\"text-transform:uppercase\" class=\"mq-text-mode\""),me.lowercase=t("\\lowercase","span","style=\"text-transform:lowercase\" class=\"mq-text-mode\""),Be=h(Se,function(s,n){s.init=function(e){n.init.call(this,"$"),this.cursor=e},s.htmlTemplate="<span class=\"mq-math-mode\">&0</span>",s.createBlocks=function(){n.createBlocks.call(this),this.ends[le].cursor=this.cursor,this.ends[le].write=function(s,t){"$"!==t?Le.prototype.write.call(this,s,t):this.isEmpty()?(s.insRightOf(this.parent),this.parent.deleteTowards(dir,s),De("\\$","$").createLeftOf(s.show())):s[oe]?s[le]?Le.prototype.write.call(this,s,t):s.insLeftOf(this.parent):s.insRightOf(this.parent)}},s.latex=function(){return"$"+this.ends[le].latex()+"$"}}),ze=h(Ae,function(s,n){s.keystroke=function(e){if("Spacebar"!==e&&"Shift-Spacebar"!==e)return n.keystroke.apply(this,arguments)},s.write=function(s,t){if(s.show().deleteSelection(),"$"===t)Be(s).createLeftOf(s);else{var e;"<"===t?e="&lt;":">"==t&&(e="&gt;"),De(t,e).createLeftOf(s)}}}),we.TextField=function(e){return h(e.EditableField,function(s,t){this.RootBlock=ze,s.__mathquillify=function(){return t.__mathquillify.call(this,"mq-editable-field mq-text-mode")},s.latex=function(e){return 0<arguments.length?(this.__controller.renderLatexText(e),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},ue["\\"]=h(Se,function(s,r){s.ctrlSeq="\\",s.replaces=function(e){this._replacedFragment=e.disown(),this.isEmpty=function(){return!1}},s.htmlTemplate="<span class=\"mq-latex-command-input mq-non-leaf\">\\<span>&0</span></span>",s.textTemplate=["\\"],s.createBlocks=function(){r.createBlocks.call(this),this.ends[le].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[le].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[le].write=function(s,t){s.show().deleteSelection(),t.match(/[a-z]/i)?De(t).createLeftOf(s):(this.parent.renderCommand(s),"\\"===t&&this.isEmpty()||s.parent.write(s,t))},this.ends[le].keystroke=function(e,t,s){return"Tab"===e||"Enter"===e||"Spacebar"===e?(this.parent.renderCommand(s.cursor),void t.preventDefault()):r.keystroke.apply(this,arguments)}},s.createLeftOf=function(e){if(r.createLeftOf.call(this,e),this._replacedFragment){var s=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(e){return pe(e.target=s).trigger(e),!1}).insertBefore(this.jQ).add(this.jQ)}},s.latex=function(){return"\\"+this.ends[le].latex()+" "},s.renderCommand=function(s){var t,r;this.jQ=this.jQ.last(),this.remove(),this[oe]?s.insLeftOf(this[oe]):s.insAtRightEnd(this.parent),t=this.ends[le].latex(),t||(t=" "),r=me[t]||Ht[t],r?(r=r(t),this._replacedFragment&&r.replaces(this._replacedFragment),r.createLeftOf(s)):(r=Re(),r.replaces(t),r.createLeftOf(s),s.insRightOf(r),this._replacedFragment&&this._replacedFragment.remove())}}),Fe=ee,Pe=document.createElement("div"),Ne=Pe.style,$e={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(Ue in $e){if(Ue in Ne){We=Ue;break}}We?Me=function(s,t,e){s.css(We,"scale("+t+","+e+")")}:"filter"in Ne?(Fe=function(e){e.className=e.className},Me=function(a,t,l){function n(){a.css("marginRight",(i.width()-1)*(t-1)/t+"px")}var i,o;t/=1+(l-1)/2,a.css("fontSize",l+"em"),a.hasClass("mq-matrixed-container")||a.addClass("mq-matrixed-container").wrapInner("<span class=\"mq-matrixed\"></span>"),i=a.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+t+",SizingMethod='auto expand')"),n(),o=setInterval(n),pe(window).load(function(){clearTimeout(o),n()})}):Me=function(s,t,e){s.css("fontSize",e+"em")},He=h(Se,function(s,r){s.init=function(e,t,s){r.init.call(this,e,"<"+t+" "+s+">&0</"+t+">")}}),me.mathrm=ne(He,"\\mathrm","span","class=\"mq-roman mq-font\""),me.mathit=ne(He,"\\mathit","i","class=\"mq-font\""),me.mathbf=ne(He,"\\mathbf","b","class=\"mq-font\""),me.mathsf=ne(He,"\\mathsf","span","class=\"mq-sans-serif mq-font\""),me.mathtt=ne(He,"\\mathtt","span","class=\"mq-monospace mq-font\""),me.underline=ne(He,"\\underline","span","class=\"mq-non-leaf mq-underline\""),me.overline=me.bar=ne(He,"\\overline","span","class=\"mq-non-leaf mq-overline\""),me.overrightarrow=ne(He,"\\overrightarrow","span","class=\"mq-non-leaf mq-overarrow mq-arrow-right\""),me.overleftarrow=ne(He,"\\overleftarrow","span","class=\"mq-non-leaf mq-overarrow mq-arrow-left\""),me.overleftrightarrow=ne(He,"\\overleftrightarrow","span","class=\"mq-non-leaf mq-overarrow mq-arrow-both\""),me.overarc=ne(He,"\\overarc","span","class=\"mq-non-leaf mq-overarc\""),me.dot=h(Se,function(s,t){s.init=function(){t.init.call(this,"\\dot","<span class=\"mq-non-leaf\"><span class=\"mq-dot-recurring-inner\"><span class=\"mq-dot-recurring\">&#x2d9;</span><span class=\"mq-empty-box\">&0</span></span></span>")}}),me.textcolor=h(Se,function(s,r){s.setColor=function(e){this.color=e,this.htmlTemplate="<span class=\"mq-textcolor\" style=\"color:"+e+"\">&0</span>"},s.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},s.parser=function(){var e=this,t=Qe.optWhitespace,n=Qe.string,a=Qe.regex;return t.then(n("{")).then(a(/^[#\w\s.,()%-]*/)).skip(n("}")).then(function(t){return e.setColor(t),r.parser.call(e)})},s.isStyleBlock=function(){return!0}}),me.class=h(Se,function(s,r){s.parser=function(){var e=this,t=Qe.string,s=Qe.regex;return Qe.optWhitespace.then(t("{")).then(s(/^[-\w\s\\\xA0-\xFF]*/)).skip(t("}")).then(function(t){return e.cls=t||"",e.htmlTemplate="<span class=\"mq-class "+t+"\">&0</span>",r.parser.call(e)})},s.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},s.isStyleBlock=function(){return!0}}),Ve=h(Se,function(s,r){s.ctrlSeq="_{...}^{...}",s.createLeftOf=function(e){if(this.replacedFragment||e[le]||!e.options.supSubsRequireOperand)return r.createLeftOf.apply(this,arguments)},s.contactWeld=function(a){var l,t,p,d,c,m;for(l=le;l;l=l===le&&oe){if(this[l]instanceof Ve){for(t="sub";t;t="sub"===t&&"sup"){p=this[t],d=this[l][t],p&&(d?p.isEmpty()?m=f(d,0,d.ends[le]):(p.jQ.children().insAtDirEnd(-l,d.jQ),c=p.children().disown(),m=f(d,c.ends[oe],d.ends[le]),l===le?c.adopt(d,d.ends[oe],0):c.adopt(d,0,d.ends[le])):this[l].addBlock(p.disown()),this.placeCursor=function(e,t){return function(s){s.insAtDirEnd(-l,e||t)}}(d,p))}this.remove(),a&&a[le]===this&&(l===oe&&m?m[le]?a.insRightOf(m[le]):a.insAtLeftEnd(m.parent):a.insRightOf(this[l]));break}}},xe.p.charsThatBreakOutOfSupSub="",s.finalizeTree=function(){this.ends[le].write=function(s,t){if(s.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===t)return;var e=this.chToCmd(t,s.options);return e instanceof _e?s.deleteSelection():s.clearSelection().insRightOf(this.parent),e.createLeftOf(s.show())}s[le]&&!s[oe]&&!s.selection&&-1<s.options.charsThatBreakOutOfSupSub.indexOf(t)&&s.insRightOf(this.parent),Le.p.write.apply(this,arguments)}},s.moveTowards=function(e,t){t.options.autoSubscriptNumerals&&!this.sup?t.insDirOf(e,this):r.moveTowards.apply(this,arguments)},s.deleteTowards=function(e,t){if(t.options.autoSubscriptNumerals&&this.sub){var s=this.sub.ends[-e];s instanceof _e?s.remove():s&&s.deleteTowards(e,t.insAtDirEnd(-e,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(le,t.insAtLeftEnd(this.sub)),this.sup&&t.insDirOf(-e,this))}else r.deleteTowards.apply(this,arguments)},s.latex=function(){function e(s,t){var e=t&&t.latex();return t?s+(1===e.length?e:"{"+(e||" ")+"}"):""}return e("_",this.sub)+e("^",this.sup)},s.addBlock=function(s){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=s,s.adopt(this,this.sub,0).downOutOf=this.sub,s.jQ=pe("<span class=\"mq-sup\"/>").append(s.jQ.children()).attr("mathquill-block-id",s.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=s,s.adopt(this,0,this.sup).upOutOf=this.sup,s.jQ=pe("<span class=\"mq-sub\"></span>").append(s.jQ.children()).attr("mathquill-block-id",s.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append("<span style=\"display:inline-block;width:0\">&#8203;</span>"));for(var t=0;2>t;t+=1){!function(a,t,e,n){a[t].deleteOutOf=function(i,s){if(s.insDirOf(this[i]?-i:i,this.parent),!this.isEmpty()){var r=this.ends[i];this.children().disown().withDirAdopt(i,s.parent,s[i],s[-i]).jQ.insDirOf(-i,s.jQ),s[-i]=r}a.supsub=e,delete a[t],delete a[n+"Into"],a[e][n+"OutOf"]=l,delete a[e].deleteOutOf,"sub"===t&&pe(a.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,["sub","sup"][t],["sup","sub"][t],["down","up"][t])}}}),me.subscript=me._=h(Ve,function(s,t){s.supsub="sub",s.htmlTemplate="<span class=\"mq-supsub mq-non-leaf\"><span class=\"mq-sub\">&0</span><span style=\"display:inline-block;width:0\">&#8203;</span></span>",s.textTemplate=["_"],s.finalizeTree=function(){this.downInto=this.sub=this.ends[le],this.sub.upOutOf=l,t.finalizeTree.call(this)}}),me.superscript=me.supscript=me["^"]=h(Ve,function(s,t){s.supsub="sup",s.htmlTemplate="<span class=\"mq-supsub mq-non-leaf mq-sup-only\"><span class=\"mq-sup\">&0</span></span>",s.textTemplate=["^"],s.finalizeTree=function(){this.upInto=this.sup=this.ends[oe],this.sup.downOutOf=l,t.finalizeTree.call(this)},s.reflow=function(){var s=this.jQ,t=s.prev().innerHeight();t*=.6,s.css("vertical-align",t+"px")}}),Ke=h(Se,function(s,n){s.init=function(s,t){_e.prototype.init.call(this,s,"<span class=\"mq-large-operator mq-non-leaf\"><span class=\"mq-to\"><span>&1</span></span><big>"+t+"</big><span class=\"mq-from\"><span>&0</span></span></span>")},s.createLeftOf=function(e){n.createLeftOf.apply(this,arguments),e.options.sumStartsWithNEquals&&(Zt("n").createLeftOf(e),ds().createLeftOf(e))},s.latex=function(){function e(e){return 1===e.length?e:"{"+(e||" ")+"}"}return this.ctrlSeq+"_"+e(this.ends[le].latex())+"^"+e(this.ends[oe].latex())},s.parser=function(){var a,l=Qe.string,e=Qe.optWhitespace,n=Qe.succeed,i=Te.block,s=this,r=s.blocks=[Le(),Le()];for(a=0;a<r.length;a+=1){r[a].adopt(s,s.ends[oe],0)}return e.then(l("_").or(l("^"))).then(function(a){var l=r["_"===a?0:1];return i.then(function(e){return e.children().adopt(l,l.ends[oe],0),n(s)})}).many().result(s)},s.finalizeTree=function(){this.downInto=this.ends[le],this.upInto=this.ends[oe],this.ends[le].upOutOf=this.ends[oe],this.ends[oe].downOutOf=this.ends[le]}}),me["\u2211"]=me.sum=me.summation=ne(Ke,"\\sum ","&sum;"),me["\u220F"]=me.prod=me.product=ne(Ke,"\\prod ","&prod;"),me.coprod=me.coproduct=ne(Ke,"\\coprod ","&#8720;"),me["\u222B"]=me.int=me.integral=h(Ke,function(e){e.init=function(){_e.prototype.init.call(this,"\\int ","<span class=\"mq-int mq-non-leaf\"><big>&int;</big><span class=\"mq-supsub mq-non-leaf\"><span class=\"mq-sup\"><span class=\"mq-sup-inner\">&1</span></span><span class=\"mq-sub\">&0</span><span style=\"display:inline-block;width:0\">&#8203</span></span></span>")},e.createLeftOf=Se.p.createLeftOf}),Ge=me.frac=me.dfrac=me.cfrac=me.fraction=h(Se,function(e){e.ctrlSeq="\\frac",e.htmlTemplate="<span class=\"mq-fraction mq-non-leaf\"><span class=\"mq-numerator\">&0</span><span class=\"mq-denominator\">&1</span><span style=\"display:inline-block;width:0\">&#8203;</span></span>",e.textTemplate=["(",")/(",")"],e.finalizeTree=function(){this.upInto=this.ends[oe].upOutOf=this.ends[le],this.downInto=this.ends[le].downOutOf=this.ends[oe]}}),Ye=me.over=ue["/"]=h(Ge,function(t,s){t.createLeftOf=function(t){if(!this.replacedFragment){for(var e=t[le];e&&!(e instanceof Ee||e instanceof(me.text||ee)||e instanceof Ke||"\\ "===e.ctrlSeq||/^[,;:]$/.test(e.ctrlSeq));){e=e[le]}e instanceof Ke&&e[oe]instanceof Ve&&(e=e[oe],e[oe]instanceof Ve&&e[oe].ctrlSeq!=e.ctrlSeq&&(e=e[oe])),e!==t[le]&&(this.replaces(ce(e[oe]||t.parent.ends[le],t[le])),t[le]=e)}s.createLeftOf.call(this,t)}}),Xe=me.sqrt=me["\u221A"]=h(Se,function(s,t){s.ctrlSeq="\\sqrt",s.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-scaled mq-sqrt-prefix\">&radic;</span><span class=\"mq-non-leaf mq-sqrt-stem\">&0</span></span>",s.textTemplate=["sqrt(",")"],s.parser=function(){return Te.optBlock.then(function(s){return Te.block.map(function(t){var e=Ze();return e.blocks=[s,t],s.adopt(e,0,0),t.adopt(e,s,0),e})}).or(t.parser.call(this))},s.reflow=function(){var e=this.ends[oe].jQ;Me(e.prev(),1,e.innerHeight()/+e.css("fontSize").slice(0,-2)-.1)}}),me.hat=h(Se,function(e){e.ctrlSeq="\\hat",e.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-hat-prefix\">^</span><span class=\"mq-hat-stem\">&0</span></span>",e.textTemplate=["hat(",")"]}),Ze=me.nthroot=h(Xe,function(e){e.htmlTemplate="<sup class=\"mq-nthroot mq-non-leaf\">&0</sup><span class=\"mq-scaled\"><span class=\"mq-sqrt-prefix mq-scaled\">&radic;</span><span class=\"mq-sqrt-stem mq-non-leaf\">&1</span></span>",e.textTemplate=["sqrt[","](",")"],e.latex=function(){return"\\sqrt["+this.ends[le].latex()+"]{"+this.ends[oe].latex()+"}"}}),Je=h(Se,function(s,r){s.init=function(e,t,s){r.init.call(this,e,"<span class=\"mq-non-leaf\"><span class=\"mq-diacritic-above\">"+t+"</span><span class=\"mq-diacritic-stem\">&0</span></span>",s)}}),me.vec=ne(Je,"\\vec","&rarr;",["vec(",")"]),me.tilde=ne(Je,"\\tilde","~",["tilde(",")"]),Bt=h(h(Se,i),function(t,a){t.init=function(n,t,e,i,s){a.init.call(this,"\\left"+i,u,[t,e]),this.side=n,this.sides={},this.sides[le]={ch:t,ctrlSeq:i},this.sides[oe]={ch:e,ctrlSeq:s}},t.numBlocks=function(){return 1},t.html=function(){return this.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-scaled mq-paren"+(this.side===oe?" mq-ghost":"")+"\">"+this.sides[le].ch+"</span><span class=\"mq-non-leaf\">&0</span><span class=\"mq-scaled mq-paren"+(this.side===le?" mq-ghost":"")+"\">"+this.sides[oe].ch+"</span></span>",a.html.call(this)},t.latex=function(){return"\\left"+this.sides[le].ctrlSeq+this.ends[le].latex()+"\\right"+this.sides[oe].ctrlSeq},t.matchBrack=function(s,t,e){return e instanceof Bt&&e.side&&e.side!==-t&&(!s.restrictMismatchedBrackets||Nt[this.sides[this.side].ch]===e.sides[e.side].ch||{"(":"]","[":")"}[this.sides[le].ch]===e.sides[oe].ch)&&e},t.closeOpposing=function(e){e.side=0,e.sides[this.side]=this.sides[this.side],e.delimjQs.eq(this.side===le?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},t.createLeftOf=function(n){var t,r,l;this.replacedFragment||(t=n.options,r="|"===this.sides[le].ch?this.matchBrack(t,oe,n[oe])||this.matchBrack(t,le,n[le])||this.matchBrack(t,0,n.parent.parent):this.matchBrack(t,-this.side,n[-this.side])||this.matchBrack(t,-this.side,n.parent.parent)),r?(l=this.side=-r.side,this.closeOpposing(r),r===n.parent.parent&&n[l]&&ce(n[l],n.parent.ends[l],-l).disown().withDirAdopt(-l,r.parent,r,r[l]).jQ.insDirOf(l,r.jQ),r.bubble("reflow")):(r=this,l=r.side,r.replacedFragment?r.side=0:n[-l]&&(r.replaces(ce(n[-l],n.parent.ends[-l],l)),n[-l]=0),a.createLeftOf.call(r,n)),l===le?n.insAtLeftEnd(r.ends[le]):n.insRightOf(r)},t.placeCursor=ee,t.unwrap=function(){this.ends[le].children().disown().adopt(this.parent,this,this[oe]).jQ.insertAfter(this.jQ),this.remove()},t.deleteSide=function(p,t,e){var n,d,c,m=this.parent,o=this[p],a=m.ends[p];if(p===this.side)return this.unwrap(),void(o?e.insDirOf(-p,o):e.insAtDirEnd(p,m));if(n=e.options,d=!this.side,this.side=-p,this.matchBrack(n,p,this.ends[le].ends[this.side]))this.closeOpposing(this.ends[le].ends[this.side]),c=this.ends[le].ends[p],this.unwrap(),c.siblingCreated&&c.siblingCreated(e.options,p),o?e.insDirOf(-p,o):e.insAtDirEnd(p,m);else{if(this.matchBrack(n,p,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(t&&d)return this.unwrap(),void(o?e.insDirOf(-p,o):e.insAtDirEnd(p,m));this.sides[p]={ch:Nt[this.sides[this.side].ch],ctrlSeq:Nt[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(p===le?0:1).addClass("mq-ghost").html(this.sides[p].ch)}o?(c=this.ends[le].ends[p],ce(o,a,-p).disown().withDirAdopt(-p,this.ends[le],c,0).jQ.insAtDirEnd(p,this.ends[le].jQ.removeClass("mq-empty")),c.siblingCreated&&c.siblingCreated(e.options,p),e.insDirOf(-p,o)):t?e.insDirOf(p,this):e.insAtDirEnd(p,this.ends[le])}},t.deleteTowards=function(s,t){this.deleteSide(-s,!1,t)},t.finalizeTree=function(){this.ends[le].deleteOutOf=function(s,t){this.parent.deleteSide(s,!0,t)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===le?1:0).removeClass("mq-ghost"),this.side=0}},t.siblingCreated=function(s,t){t===-this.side&&this.finalizeTree()}}),Nt={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},o("("),o("["),o("{","\\{"),me.langle=ne(Bt,le,"&lang;","&rang;","\\langle ","\\rangle "),me.rangle=ne(Bt,oe,"&lang;","&rang;","\\langle ","\\rangle "),ue["|"]=ne(Bt,le,"|","|","|","|"),me.lVert=ne(Bt,le,"&#8741;","&#8741;","\\lVert ","\\rVert "),me.rVert=ne(Bt,oe,"&#8741;","&#8741;","\\lVert ","\\rVert "),me.left=h(Se,function(e){e.parser=function(){var a=Qe.regex,t=Qe.string,e=(Qe.succeed,Qe.optWhitespace);return e.then(a(/^(?:[([|]|\\\{|\\langle\b|\\lVert\b)/)).then(function(l){var o="\\"===l.charAt(0)?l.slice(1):l;return"\\langle"==l&&(o="&lang;",l+=" "),"\\lVert"==l&&(o="&#8741;",l+=" "),Te.then(function(s){return t("\\right").skip(e).then(a(/^(?:[\])|]|\\\}|\\rangle\b|\\rVert\b)/)).map(function(r){var a,i="\\"===r.charAt(0)?r.slice(1):r;return"\\rangle"==r&&(i="&rang;",r+=" "),"\\rVert"==r&&(i="&#8741;",r+=" "),a=Bt(0,o,i,l,r),a.blocks=[s],s.adopt(a,0,0),a})})})}}),me.right=h(Se,function(e){e.parser=function(){return Qe.fail("unmatched \\right")}}),Wt=me.binom=me.binomial=h(h(Se,i),function(e){e.ctrlSeq="\\binom",e.htmlTemplate="<span class=\"mq-non-leaf\"><span class=\"mq-paren mq-scaled\">(</span><span class=\"mq-non-leaf\"><span class=\"mq-array mq-non-leaf\"><span>&0</span><span>&1</span></span></span><span class=\"mq-paren mq-scaled\">)</span></span>",e.textTemplate=["choose(",",",")"]}),me.choose=h(Wt,function(e){e.createLeftOf=Ye.prototype.createLeftOf}),me.editable=me.MathQuillMathField=h(Se,function(s,a){s.ctrlSeq="\\MathQuillMathField",s.htmlTemplate="<span class=\"mq-editable-field\"><span class=\"mq-root-block\">&0</span></span>",s.parser=function(){var r=this,e=Qe.string,t=Qe.regex,n=Qe.succeed;return e("[").then(t(/^[a-z][a-z0-9]*/i)).skip(e("]")).map(function(t){r.name=t}).or(n()).then(a.parser.call(r))},s.finalizeTree=function(s){var t=ge(this.ends[le],this.jQ,s);t.KIND_OF_MQ="MathField",t.editable=!0,t.createTextarea(),t.editablesTextareaEvents(),t.cursor.insAtRightEnd(t.root),r(t.root)},s.registerInnerField=function(s,t){s.push(s[this.name]=t(this.ends[le].controller))},s.latex=function(){return this.ends[le].latex()},s.text=function(){return this.ends[le].text()}}),Ut=me.embed=h(_e,function(e){e.setOptions=function(s){function t(){return""}return this.text=s.text||t,this.htmlTemplate=s.htmlString||"",this.latex=s.latex||t,this},e.parser=function(){var r=this,t=Qe.string,e=Qe.regex,n=Qe.succeed;return t("{").then(e(/^[a-z][a-z0-9]*/i)).skip(t("}")).then(function(a){return t("[").then(e(/^[-\w\s]*/)).skip(t("]")).or(n()).map(function(t){return r.setOptions(ye[a](t))})})}}),Ht={},me.begin=h(Se,function(e){e.parser=function(){var s=Qe.string,t=Qe.regex;return s("{").then(t(/^[a-z]+/i)).skip(s("}")).then(function(t){return(Ht[t]?Ht[t]().parser():Qe.fail("unknown environment type: "+t)).skip(s("\\end{"+t+"}"))})}}),Vt=h(Se,function(e){e.template=[["\\begin{","}"],["\\end{","}"]],e.wrappers=function(){return[e.template[0].join(this.environment),e.template[1].join(this.environment)]}}),Kt=Ht.matrix=h(Vt,function(s,a){var l={column:"&",row:"\\\\"};s.parentheses={left:null,right:null},s.environment="matrix",s.reflow=function(){var s=this.jQ.children("table"),t=s.outerHeight()/+s.css("fontSize").slice(0,-2),e=this.jQ.children(".mq-paren");e.length&&Me(e,Ft(1+.2*(t-1),1.2),1.05*t)},s.latex=function(){var s,n="";return this.eachChild(function(e){void 0!==s&&(n+=s!==e.row?l.row:l.column),s=e.row,n+=e.latex()}),this.wrappers().join(n)},s.html=function(){function e(e){return e?"<span class=\"mq-scaled mq-paren\">"+e+"</span>":""}var l,o=[],i="",p=0;return this.eachChild(function(e){l!==e.row&&(l=e.row,i+="<tr>$tds</tr>",o[l]=[]),o[l].push("<td>&"+p++ +"</td>")}),this.htmlTemplate="<span class=\"mq-matrix mq-non-leaf\">"+e(this.parentheses.left)+"<table class=\"mq-non-leaf\">"+i.replace(/\$tds/g,function(){return o.shift().join("")})+"</table>"+e(this.parentheses.right)+"</span>",a.html.call(this)},s.createBlocks=function(){this.blocks=[Gt(0,this),Gt(0,this),Gt(1,this),Gt(1,this)]},s.parser=function(){var n=this,t=Qe.optWhitespace,e=Qe.string;return t.then(e(l.column).or(e(l.row)).or(Te.block)).many().skip(t).then(function(t){function e(){n.blocks.push(Gt(p,n,i)),i=[]}var a,i=[],p=0;for(n.blocks=[],a=0;a<t.length;a+=1){t[a]instanceof Le?i.push(t[a]):(e(),t[a]===l.row&&(p+=1))}return e(),n.autocorrect(),Qe.succeed(n)})},s.finalizeTree=function(){var e=this.jQ.find("table");e.toggleClass("mq-rows-1",1===e.find("tr").length),this.relink()},s.getEntryPoint=function(s,t,e){return"up"===e?s===le?this.blocks[this.rowSize-1]:this.blocks[0]:s===le?this.blocks[this.blocks.length-1]:this.blocks[this.blocks.length-this.rowSize]},s.atExitPoint=function(s,t){var e=this.blocks.indexOf(t.parent);return s===le?0==e%this.rowSize:0==(e+1)%this.rowSize},s.moveTowards=function(s,t,e){var n=e&&this.getEntryPoint(s,t,e);t.insAtDirEnd(-s,n||this.ends[-s])},s.relink=function(){var a,l,o,p,d=this.blocks,s=[];for(this.rowSize=d.length,p=0;p<d.length;p+=1){o=d[p],a!==o.row&&(1===o.row&&(this.rowSize=l),a=o.row,s[a]=[],l=0),s[a][l]=o,o[oe]=d[p+1],o[le]=d[p-1],s[a-1]&&s[a-1][l]&&(o.upOutOf=s[a-1][l],s[a-1][l].downOutOf=o),l+=1}this.ends[le]=d[0],this.ends[oe]=d[d.length-1]},s.autocorrect=function(l){var c,m,u,h,f,g,w=[];for(l=[],c=this.blocks,g=0;g<c.length;g+=1){f=c[g].row,l[f]=l[f]||[],l[f].push(c[g]),w[f]=l[f].length}if((m=p.apply(null,w))!==d.apply(null,w)){for(g=0;g<l.length;g+=1){for(u=m-l[g].length;u;){h=m*g+l[g].length,c.splice(h,0,Gt(g,this)),u-=1}}this.relink()}},s.deleteCell=function(p){function t(s){var t,r=[];for(t=0;t<s.length;t+=1){s[t].isEmpty()&&r.push(s[t])}return r.length===s.length}function e(s){for(var t=0;t<s.length;t+=1){-1<h.indexOf(s[t])&&(s[t].remove(),h.splice(h.indexOf(s[t]),1))}}var n,d,m=[],r=[],o=[],u=[],h=this.blocks;this.eachChild(function(t){n!==t.row&&(n=t.row,m[n]=[],d=0),r[d]=r[d]||[],r[d].push(t),m[n].push(t),t===p&&(o=m[n],u=r[d]),d+=1}),t(o)&&1<u.length&&(n=m.indexOf(o),this.eachChild(function(e){e.row>n&&(e.row-=1)}),e(o),this.jQ.find("tr").eq(n).remove()),t(u)&&1<o.length&&e(u),this.finalizeTree()},s.backspace=function(r,t,e,n){var a=r[t];if(r.isEmpty()){for(this.deleteCell(r);a&&a[t]&&-1===this.blocks.indexOf(a);){a=a[t]}a&&e.insAtDirEnd(-t,a),1===this.blocks.length&&this.blocks[0].isEmpty()&&(n(),this.finalizeTree()),this.bubble("edited")}}}),Ht.pmatrix=h(Kt,function(e){e.environment="pmatrix",e.parentheses={left:"(",right:")"}}),Ht.bmatrix=h(Kt,function(e){e.environment="bmatrix",e.parentheses={left:"[",right:"]"}}),Ht.Bmatrix=h(Kt,function(e){e.environment="Bmatrix",e.parentheses={left:"{",right:"}"}}),Ht.vmatrix=h(Kt,function(e){e.environment="vmatrix",e.parentheses={left:"|",right:"|"}}),Ht.Vmatrix=h(Kt,function(e){e.environment="Vmatrix",e.parentheses={left:"&#8214;",right:"&#8214;"}}),Gt=h(Le,function(s,r){s.init=function(e,t,n){if(r.init.call(this),this.row=e,t&&this.adopt(t,t.ends[oe],0),n)for(var a=0;a<n.length;a++){n[a].children().adopt(this,this.ends[oe],0)}},s.deleteOutOf=function(e,t){var n=this,a=arguments;this.parent.backspace(this,e,t,function(){return r.deleteOutOf.apply(n,a)})},s.moveOutOf=function(s,t,e){e&&this.parent.atExitPoint(s,t)||!this[s]?t.insDirOf(s,this.parent):t.insAtDirEnd(-s,this[s])}}),me.notin=me.cong=me.equiv=me.oplus=me.otimes=h(Ee,function(s,n){s.init=function(e){n.init.call(this,"\\"+e+" ","&"+e+";")}}),me["\u2260"]=me.ne=me.neq=ne(Ee,"\\ne ","&ne;"),me["\u2217"]=me.ast=me.star=me.loast=me.lowast=ne(Ee,"\\ast ","&lowast;"),me.therefor=me.therefore=ne(Ee,"\\therefore ","&there4;"),me.cuz=me.because=ne(Ee,"\\because ","&#8757;"),me.prop=me.propto=ne(Ee,"\\propto ","&prop;"),me["\u2248"]=me.asymp=me.approx=ne(Ee,"\\approx ","&asymp;"),me.isin=me.in=ne(Ee,"\\in ","&isin;"),me.ni=me.contains=ne(Ee,"\\ni ","&ni;"),me.notni=me.niton=me.notcontains=me.doesnotcontain=ne(Ee,"\\not\\ni ","&#8716;"),me.sub=me.subset=ne(Ee,"\\subset ","&sub;"),me.sup=me.supset=me.superset=ne(Ee,"\\supset ","&sup;"),me.nsub=me.notsub=me.nsubset=me.notsubset=ne(Ee,"\\not\\subset ","&#8836;"),me.nsup=me.notsup=me.nsupset=me.notsupset=me.nsuperset=me.notsuperset=ne(Ee,"\\not\\supset ","&#8837;"),me.sube=me.subeq=me.subsete=me.subseteq=ne(Ee,"\\subseteq ","&sube;"),me.supe=me.supeq=me.supsete=me.supseteq=me.supersete=me.superseteq=ne(Ee,"\\supseteq ","&supe;"),me.nsube=me.nsubeq=me.notsube=me.notsubeq=me.nsubsete=me.nsubseteq=me.notsubsete=me.notsubseteq=ne(Ee,"\\not\\subseteq ","&#8840;"),me.nsupe=me.nsupeq=me.notsupe=me.notsupeq=me.nsupsete=me.nsupseteq=me.notsupsete=me.notsupseteq=me.nsupersete=me.nsuperseteq=me.notsupersete=me.notsuperseteq=ne(Ee,"\\not\\supseteq ","&#8841;"),me.N=me.naturals=me.Naturals=ne(De,"\\mathbb{N}","&#8469;"),me.P=me.primes=me.Primes=me.projective=me.Projective=me.probability=me.Probability=ne(De,"\\mathbb{P}","&#8473;"),me.Z=me.integers=me.Integers=ne(De,"\\mathbb{Z}","&#8484;"),me.Q=me.rationals=me.Rationals=ne(De,"\\mathbb{Q}","&#8474;"),me.R=me.reals=me.Reals=ne(De,"\\mathbb{R}","&#8477;"),me.C=me.complex=me.Complex=me.complexes=me.Complexes=me.complexplane=me.Complexplane=me.ComplexPlane=ne(De,"\\mathbb{C}","&#8450;"),me.H=me.Hamiltonian=me.quaternions=me.Quaternions=ne(De,"\\mathbb{H}","&#8461;"),me.quad=me.emsp=ne(De,"\\quad ","    "),me.qquad=ne(De,"\\qquad ","        "),me.diamond=ne(De,"\\diamond ","&#9671;"),me.bigtriangleup=ne(De,"\\bigtriangleup ","&#9651;"),me.ominus=ne(De,"\\ominus ","&#8854;"),me.uplus=ne(De,"\\uplus ","&#8846;"),me.bigtriangledown=ne(De,"\\bigtriangledown ","&#9661;"),me.sqcap=ne(De,"\\sqcap ","&#8851;"),me.triangleleft=ne(De,"\\triangleleft ","&#8882;"),me.sqcup=ne(De,"\\sqcup ","&#8852;"),me.triangleright=ne(De,"\\triangleright ","&#8883;"),me.odot=me.circledot=ne(De,"\\odot ","&#8857;"),me.bigcirc=ne(De,"\\bigcirc ","&#9711;"),me.dagger=ne(De,"\\dagger ","&#0134;"),me.ddagger=ne(De,"\\ddagger ","&#135;"),me.wr=ne(De,"\\wr ","&#8768;"),me.amalg=ne(De,"\\amalg ","&#8720;"),me.models=ne(De,"\\models ","&#8872;"),me.prec=ne(De,"\\prec ","&#8826;"),me.succ=ne(De,"\\succ ","&#8827;"),me.preceq=ne(De,"\\preceq ","&#8828;"),me.succeq=ne(De,"\\succeq ","&#8829;"),me.simeq=ne(De,"\\simeq ","&#8771;"),me.mid=ne(De,"\\mid ","&#8739;"),me.ll=ne(De,"\\ll ","&#8810;"),me.gg=ne(De,"\\gg ","&#8811;"),me.parallel=ne(De,"\\parallel ","&#8741;"),me.nparallel=ne(De,"\\nparallel ","&#8742;"),me.bowtie=ne(De,"\\bowtie ","&#8904;"),me.sqsubset=ne(De,"\\sqsubset ","&#8847;"),me.sqsupset=ne(De,"\\sqsupset ","&#8848;"),me.smile=ne(De,"\\smile ","&#8995;"),me.sqsubseteq=ne(De,"\\sqsubseteq ","&#8849;"),me.sqsupseteq=ne(De,"\\sqsupseteq ","&#8850;"),me.doteq=ne(De,"\\doteq ","&#8784;"),me.frown=ne(De,"\\frown ","&#8994;"),me.vdash=ne(De,"\\vdash ","&#8870;"),me.dashv=ne(De,"\\dashv ","&#8867;"),me.nless=ne(De,"\\nless ","&#8814;"),me.ngtr=ne(De,"\\ngtr ","&#8815;"),me.longleftarrow=ne(De,"\\longleftarrow ","&#8592;"),me.longrightarrow=ne(De,"\\longrightarrow ","&#8594;"),me.Longleftarrow=ne(De,"\\Longleftarrow ","&#8656;"),me.Longrightarrow=ne(De,"\\Longrightarrow ","&#8658;"),me.longleftrightarrow=ne(De,"\\longleftrightarrow ","&#8596;"),me.updownarrow=ne(De,"\\updownarrow ","&#8597;"),me.Longleftrightarrow=ne(De,"\\Longleftrightarrow ","&#8660;"),me.Updownarrow=ne(De,"\\Updownarrow ","&#8661;"),me.mapsto=ne(De,"\\mapsto ","&#8614;"),me.nearrow=ne(De,"\\nearrow ","&#8599;"),me.hookleftarrow=ne(De,"\\hookleftarrow ","&#8617;"),me.hookrightarrow=ne(De,"\\hookrightarrow ","&#8618;"),me.searrow=ne(De,"\\searrow ","&#8600;"),me.leftharpoonup=ne(De,"\\leftharpoonup ","&#8636;"),me.rightharpoonup=ne(De,"\\rightharpoonup ","&#8640;"),me.swarrow=ne(De,"\\swarrow ","&#8601;"),me.leftharpoondown=ne(De,"\\leftharpoondown ","&#8637;"),me.rightharpoondown=ne(De,"\\rightharpoondown ","&#8641;"),me.nwarrow=ne(De,"\\nwarrow ","&#8598;"),me.ldots=ne(De,"\\ldots ","&#8230;"),me.cdots=ne(De,"\\cdots ","&#8943;"),me.vdots=ne(De,"\\vdots ","&#8942;"),me.ddots=ne(De,"\\ddots ","&#8945;"),me.surd=ne(De,"\\surd ","&#8730;"),me.triangle=ne(De,"\\triangle ","&#9651;"),me.ell=ne(De,"\\ell ","&#8467;"),me.top=ne(De,"\\top ","&#8868;"),me.flat=ne(De,"\\flat ","&#9837;"),me.natural=ne(De,"\\natural ","&#9838;"),me.sharp=ne(De,"\\sharp ","&#9839;"),me.wp=ne(De,"\\wp ","&#8472;"),me.bot=ne(De,"\\bot ","&#8869;"),me.clubsuit=ne(De,"\\clubsuit ","&#9827;"),me.diamondsuit=ne(De,"\\diamondsuit ","&#9826;"),me.heartsuit=ne(De,"\\heartsuit ","&#9825;"),me.spadesuit=ne(De,"\\spadesuit ","&#9824;"),me.parallelogram=ne(De,"\\parallelogram ","&#9649;"),me.square=ne(De,"\\square ","&#11036;"),me.oint=ne(De,"\\oint ","&#8750;"),me.bigcap=ne(De,"\\bigcap ","&#8745;"),me.bigcup=ne(De,"\\bigcup ","&#8746;"),me.bigsqcup=ne(De,"\\bigsqcup ","&#8852;"),me.bigvee=ne(De,"\\bigvee ","&#8744;"),me.bigwedge=ne(De,"\\bigwedge ","&#8743;"),me.bigodot=ne(De,"\\bigodot ","&#8857;"),me.bigotimes=ne(De,"\\bigotimes ","&#8855;"),me.bigoplus=ne(De,"\\bigoplus ","&#8853;"),me.biguplus=ne(De,"\\biguplus ","&#8846;"),me.lfloor=ne(De,"\\lfloor ","&#8970;"),me.rfloor=ne(De,"\\rfloor ","&#8971;"),me.lceil=ne(De,"\\lceil ","&#8968;"),me.rceil=ne(De,"\\rceil ","&#8969;"),me.opencurlybrace=me.lbrace=ne(De,"\\lbrace ","{"),me.closecurlybrace=me.rbrace=ne(De,"\\rbrace ","}"),me.lbrack=ne(De,"["),me.rbrack=ne(De,"]"),me.slash=ne(De,"/"),me.vert=ne(De,"|"),me.perp=me.perpendicular=ne(De,"\\perp ","&perp;"),me.nabla=me.del=ne(De,"\\nabla ","&nabla;"),me.hbar=ne(De,"\\hbar ","&#8463;"),me.AA=me.Angstrom=me.angstrom=ne(De,"\\text\\AA ","&#8491;"),me.ring=me.circ=me.circle=ne(De,"\\circ ","&#8728;"),me.bull=me.bullet=ne(De,"\\bullet ","&bull;"),me.setminus=me.smallsetminus=ne(De,"\\setminus ","&#8726;"),me.not=me["\xAC"]=me.neg=ne(De,"\\neg ","&not;"),me["\u2026"]=me.dots=me.ellip=me.hellip=me.ellipsis=me.hellipsis=ne(De,"\\dots ","&hellip;"),me.converges=me.darr=me.dnarr=me.dnarrow=me.downarrow=ne(De,"\\downarrow ","&darr;"),me.dArr=me.dnArr=me.dnArrow=me.Downarrow=ne(De,"\\Downarrow ","&dArr;"),me.diverges=me.uarr=me.uparrow=ne(De,"\\uparrow ","&uarr;"),me.uArr=me.Uparrow=ne(De,"\\Uparrow ","&uArr;"),me.to=ne(Ee,"\\to ","&rarr;"),me.rarr=me.rightarrow=ne(De,"\\rightarrow ","&rarr;"),me.implies=ne(Ee,"\\Rightarrow ","&rArr;"),me.rArr=me.Rightarrow=ne(De,"\\Rightarrow ","&rArr;"),me.gets=ne(Ee,"\\gets ","&larr;"),me.larr=me.leftarrow=ne(De,"\\leftarrow ","&larr;");me.impliedby=ne(Ee,"\\Leftarrow ","&lArr;"),me.lArr=me.Leftarrow=ne(De,"\\Leftarrow ","&lArr;"),me.harr=me.lrarr=me.leftrightarrow=ne(De,"\\leftrightarrow ","&harr;"),me.iff=ne(Ee,"\\Leftrightarrow ","&hArr;"),me.hArr=me.lrArr=me.Leftrightarrow=ne(De,"\\Leftrightarrow ","&hArr;"),me.Re=me.Real=me.real=ne(De,"\\Re ","&real;"),me.Im=me.imag=me.image=me.imagin=me.imaginary=me.Imaginary=ne(De,"\\Im ","&image;"),me.part=me.partial=ne(De,"\\partial ","&part;"),me.infty=me.infin=me.infinity=ne(De,"\\infty ","&infin;"),me.alef=me.alefsym=me.aleph=me.alephsym=ne(De,"\\aleph ","&alefsym;"),me.xist=me.xists=me.exist=me.exists=ne(De,"\\exists ","&exist;"),me.nexists=me.nexist=ne(De,"\\nexists ","&#8708;"),me.and=me.land=me.wedge=ne(Ee,"\\wedge ","&and;"),me.or=me.lor=me.vee=ne(Ee,"\\vee ","&or;"),me.o=me.O=me.empty=me.emptyset=me.oslash=me.Oslash=me.nothing=me.varnothing=ne(Ee,"\\varnothing ","&empty;"),me.cup=me.union=ne(Ee,"\\cup ","&cup;"),me.cap=me.intersect=me.intersection=ne(Ee,"\\cap ","&cap;"),me.deg=me.degree=ne(De,"\\degree ","&deg;"),me.ang=me.angle=ne(De,"\\angle ","&ang;"),me.measuredangle=ne(De,"\\measuredangle ","&#8737;"),Yt=h(De,function(s,n){s.createLeftOf=function(e){e.options.autoSubscriptNumerals&&e.parent!==e.parent.parent.sub&&(e[le]instanceof Xt&&!1!==e[le].isItalic||e[le]instanceof Ve&&e[le][le]instanceof Xt&&!1!==e[le][le].isItalic)?(me._().createLeftOf(e),n.createLeftOf.call(this,e),e.insRightOf(e.parent.parent)):n.createLeftOf.call(this,e)}}),Xt=h(_e,function(s,r){s.init=function(e,t){r.init.call(this,e,"<var>"+(t||e)+"</var>")},s.text=function(){var e=this.ctrlSeq;return this.isPartOfOperator?"\\"==e[0]?e=e.slice(1,e.length):" "==e[e.length-1]&&(e=e.slice(0,-1)):(!this[le]||this[le]instanceof Xt||this[le]instanceof Ee||"\\ "===this[le].ctrlSeq||(e="*"+e),!this[oe]||this[oe]instanceof Ee||this[oe]instanceof Ve||(e+="*")),e}}),xe.p.autoCommands={_maxLength:0},be.autoCommands=function(a){var t,l,o,p,d;if(!/^[a-z]+(?: [a-z]+)*$/i.test(a))throw"\""+a+"\" not a space-delimited list of only letters";for(t=a.split(" "),l={},o=0,p=0;p<t.length;p+=1){if(d=t[p],2>d.length)throw"autocommand \""+d+"\" not minimum length of 2";if(me[d]===ss)throw"\""+d+"\" is a built-in operator name";l[d]=1,o=$t(o,d.length)}return l._maxLength=o,l},Zt=h(Xt,function(s,a){function e(e){return!e||e instanceof Ee||e instanceof Ke}s.init=function(e){return a.init.call(this,this.letter=e)},s.createLeftOf=function(e){var t,l,p,d,c;if(a.createLeftOf.apply(this,arguments),t=e.options.autoCommands,l=t._maxLength,0<l){for(p="",d=this,c=0;d instanceof Zt&&d.ctrlSeq===d.letter&&c<l;){p=d.letter+p,d=d[le],c+=1}for(;p.length;){if(t.hasOwnProperty(p)){for(c=1,d=this;c<p.length;c+=1,d=d[le]){}return ce(d,this).remove(),e[le]=d[le],me[p](p).createLeftOf(e)}p=p.slice(1)}}},s.italicize=function(e){return this.isItalic=e,this.isPartOfOperator=!e,this.jQ.toggleClass("mq-operator-name",!e),this},s.finalizeTree=s.siblingDeleted=s.siblingCreated=function(s,t){t!==le&&this[oe]instanceof Zt||this.autoUnItalicize(s)},s.autoUnItalicize=function(n){var t,m,g,w,x,b,q,y,O,v,k,j,Q=n.autoOperatorNames;if(0!==Q._maxLength){for(t=this.letter,m=this[le];m instanceof Zt;m=m[le]){t=m.letter+t}for(g=this[oe];g instanceof Zt;g=g[oe]){t+=g.letter}ce(m[oe]||this.parent.ends[le],g[le]||this.parent.ends[oe]).each(function(e){e.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),e.ctrlSeq=e.letter});t:for(w=0,x=m[oe]||this.parent.ends[le];w<t.length;w+=1,x=x[oe]){for(b=Ft(Q._maxLength,t.length-w);0<b;b-=1){if(q=t.slice(w,w+b),Q.hasOwnProperty(q)){for(y=0,O=x;y<b;y+=1,O=O[oe]){O.italicize(!1),v=O}k=Jt.hasOwnProperty(q),x.ctrlSeq=(k?"\\":"\\operatorname{")+x.ctrlSeq,v.ctrlSeq+=k?" ":"}",ts.hasOwnProperty(q)&&v[le][le][le].jQ.addClass("mq-last"),e(x[le])||x.jQ.addClass("mq-first"),e(v[oe])||(v[oe]instanceof Ve?(j=v[oe],(j.siblingCreated=j.siblingDeleted=function(){j.jQ.toggleClass("mq-after-operator-name",!(j[oe]instanceof Bt))})()):v.jQ.toggleClass("mq-last",!(v[oe]instanceof Bt))),w+=b-1,x=v;continue t}}}}}}),Jt={},es=xe.p.autoOperatorNames={_maxLength:9},ts={limsup:1,liminf:1,projlim:1,injlim:1},function(){var r,a,l,o,p=["arg","deg","det","dim","exp","gcd","hom","inf","ker","lg","lim","ln","log","max","min","sup","limsup","liminf","injlim","projlim","Pr"];for(r=0;r<p.length;r+=1){Jt[p[r]]=es[p[r]]=1}for(a=["sin","cos","tan","arcsin","arccos","arctan","sinh","cosh","tanh","sec","csc","cot","coth"],r=0;r<a.length;r+=1){Jt[a[r]]=1}for(l=["sin","cos","tan","sec","cosec","csc","cotan","cot","ctg"],r=0;r<l.length;r+=1){es[l[r]]=es["arc"+l[r]]=es[l[r]+"h"]=es["ar"+l[r]+"h"]=es["arc"+l[r]+"h"]=1}for(o=["gcf","hcf","lcm","proj","span"],r=0;r<o.length;r+=1){es[o[r]]=1}}(),be.autoOperatorNames=function(a){var t,l,o,p,d;if(!/^[a-z]+(?: [a-z]+)*$/i.test(a))throw"\""+a+"\" not a space-delimited list of only letters";for(t=a.split(" "),l={},o=0,p=0;p<t.length;p+=1){if(d=t[p],2>d.length)throw"\""+d+"\" not minimum length of 2";l[d]=1,o=$t(o,d.length)}return l._maxLength=o,l},ss=h(_e,function(e){e.init=function(e){this.ctrlSeq=e},e.createLeftOf=function(s){var t,r=this.ctrlSeq;for(t=0;t<r.length;t+=1){Zt(r.charAt(t)).createLeftOf(s)}},e.parser=function(){var s,r=this.ctrlSeq,e=Le();for(s=0;s<r.length;s+=1){Zt(r.charAt(s)).adopt(e,e.ends[oe],0)}return Qe.succeed(e.children())}});for(ns in es){es.hasOwnProperty(ns)&&(me[ns]=ss)}me.operatorname=h(Se,function(t){t.createLeftOf=ee,t.numBlocks=function(){return 1},t.parser=function(){return Te.block.map(function(e){return e.children()})}}),me.f=h(Zt,function(s,n){s.init=function(){_e.p.init.call(this,this.letter="f","<var class=\"mq-f\">f</var>")},s.italicize=function(e){return this.jQ.html("f").toggleClass("mq-f",e),n.italicize.apply(this,arguments)}}),me[" "]=me.space=ne(De,"\\ ","&nbsp;"),me["'"]=me.prime=ne(De,"'","&prime;"),me["\u2033"]=me.dprime=ne(De,"\u2033","&Prime;"),me.backslash=ne(De,"\\backslash ","\\"),ue["\\"]||(ue["\\"]=me.backslash),me.$=ne(De,"\\$","$"),rs=h(_e,function(s,r){s.init=function(e,t){r.init.call(this,e,"<span class=\"mq-nonSymbola\">"+(t||e)+"</span>")}}),me["@"]=rs,me["&"]=ne(rs,"\\&","&amp;"),me["%"]=ne(rs,"\\%","%"),me.alpha=me.beta=me.gamma=me.delta=me.zeta=me.eta=me.theta=me.iota=me.kappa=me.mu=me.nu=me.xi=me.rho=me.sigma=me.tau=me.chi=me.psi=me.omega=h(Xt,function(s,n){s.init=function(e){n.init.call(this,"\\"+e+" ","&"+e+";")}}),me.phi=ne(Xt,"\\phi ","&#981;"),me.phiv=me.varphi=ne(Xt,"\\varphi ","&phi;"),me.epsilon=ne(Xt,"\\epsilon ","&#1013;"),me.epsiv=me.varepsilon=ne(Xt,"\\varepsilon ","&epsilon;"),me.piv=me.varpi=ne(Xt,"\\varpi ","&piv;"),me.sigmaf=me.sigmav=me.varsigma=ne(Xt,"\\varsigma ","&sigmaf;"),me.thetav=me.vartheta=me.thetasym=ne(Xt,"\\vartheta ","&thetasym;"),me.upsilon=me.upsi=ne(Xt,"\\upsilon ","&upsilon;"),me.gammad=me.Gammad=me.digamma=ne(Xt,"\\digamma ","&#989;"),me.kappav=me.varkappa=ne(Xt,"\\varkappa ","&#1008;"),me.rhov=me.varrho=ne(Xt,"\\varrho ","&#1009;"),me.pi=me.π=ne(rs,"\\pi ","&pi;"),me.lambda=ne(rs,"\\lambda ","&lambda;"),me.Upsilon=me.Upsi=me.upsih=me.Upsih=ne(_e,"\\Upsilon ","<var style=\"font-family: serif\">&upsih;</var>"),me.Gamma=me.Delta=me.Theta=me.Lambda=me.Xi=me.Pi=me.Sigma=me.Phi=me.Psi=me.Omega=me.forall=h(De,function(s,n){s.init=function(e){n.init.call(this,"\\"+e+" ","&"+e+";")}}),as=h(Se,function(e){e.init=function(e){this.latex=e},e.createLeftOf=function(s){var t=Te.parse(this.latex);t.children().adopt(s.parent,s[le],s[oe]),s[le]=t.ends[oe],t.jQize().insertBefore(s.jQ),t.finalizeInsert(s.options,s),t.ends[oe][oe].siblingCreated&&t.ends[oe][oe].siblingCreated(s.options,le),t.ends[le][le].siblingCreated&&t.ends[le][le].siblingCreated(s.options,oe),s.parent.bubble("reflow")},e.parser=function(){var e=Te.parse(this.latex).children();return Qe.succeed(e)}}),me["\xB9"]=ne(as,"^1"),me["\xB2"]=ne(as,"^2"),me["\xB3"]=ne(as,"^3"),me["\xBC"]=ne(as,"\\frac14"),me["\xBD"]=ne(as,"\\frac12"),me["\xBE"]=ne(as,"\\frac34"),is=h(Ee,function(e){e.init=De.prototype.init,e.contactWeld=e.siblingCreated=e.siblingDeleted=function(s,t){function e(s){return s[le]?s[le]instanceof Ee||/^[,;:\(\[]$/.test(s[le].ctrlSeq)?"":"mq-binary-operator":s.parent&&s.parent.parent&&s.parent.parent.isStyleBlock()?e(s.parent.parent):""}if(t!==oe)return this.jQ[0].className=e(this),this}}),me["+"]=ne(is,"+","+"),me["\u2013"]=me["-"]=ne(is,"-","&minus;"),me["\xB1"]=me.pm=me.plusmn=me.plusminus=ne(is,"\\pm ","&plusmn;"),me.mp=me.mnplus=me.minusplus=ne(is,"\\mp ","&#8723;"),ue["*"]=me.sdot=me.cdot=ne(Ee,"\\cdot ","&middot;","*"),ls=h(Ee,function(s,r){s.init=function(e,t){this.data=e,this.strict=t;var s=t?"Strict":"";r.init.call(this,e["ctrlSeq"+s],e["html"+s],e["text"+s])},s.swap=function(s){this.strict=s;var t=s?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+t],this.jQ.html(this.data["html"+t]),this.textTemplate=[this.data["text"+t]]},s.deleteTowards=function(e){if(e===le&&!this.strict)return this.swap(!0),void this.bubble("reflow");r.deleteTowards.apply(this,arguments)}}),os={ctrlSeq:"\\le ",html:"&le;",text:"\u2264",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},ps={ctrlSeq:"\\ge ",html:"&ge;",text:"\u2265",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},me["<"]=me.lt=ne(ls,os,!0),me[">"]=me.gt=ne(ls,ps,!0),me["\u2264"]=me.le=me.leq=ne(ls,os,!1),me["\u2265"]=me.ge=me.geq=ne(ls,ps,!1),ds=h(Ee,function(s,n){s.init=function(){n.init.call(this,"=","=")},s.createLeftOf=function(e){if(e[le]instanceof ls&&e[le].strict)return e[le].swap(!1),void e[le].bubble("reflow");n.createLeftOf.apply(this,arguments)}}),me["="]=ds,me["\xD7"]=me.times=ne(Ee,"\\times ","&times;","[x]"),me["\xF7"]=me.div=me.divide=me.divides=ne(Ee,"\\div ","&divide;","[/]"),ue["~"]=me.sim=ne(Ee,"\\sim ","~","~"),cs=e(1);for(ms in cs){!function(r,t){"function"==typeof t?(n[r]=function(){return s(),t.apply(this,arguments)},n[r].prototype=t.prototype):n[r]=t}(ms,cs[ms])}}();